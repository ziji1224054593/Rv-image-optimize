"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const T=require("react");function $e(){const t=[];if(typeof window<"u"&&typeof document<"u"){const n=(()=>{try{const r=document.createElement("canvas");return r.width=1,r.height=1,r.toDataURL("image/webp").indexOf("data:image/webp")===0}catch{return!1}})();(()=>{try{const r=document.createElement("canvas");return r.width=1,r.height=1,r.toDataURL("image/avif").indexOf("data:image/avif")===0}catch{return!1}})()&&t.push("avif"),n&&t.push("webp")}return t.push("jpg","jpeg","png"),t}function Be(t=null){const o=$e();if(t){const n=t.toLowerCase().replace("jpeg","jpg");if(o.includes(n))return n}return o[0]||"jpg"}function rt(t){if(!t)return null;const n=t.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp|avif|bmp|svg)(\?|$)/i);if(n){const a=n[1].toLowerCase();return a==="jpeg"?"jpg":a}try{const a=new URL(t),r=a.searchParams.get("format")||a.searchParams.get("f")||a.searchParams.get("image_format");if(r)return r.toLowerCase().replace("jpeg","jpg")}catch{}return null}const Ct={aliyun:{test:t=>t.includes("aliyuncs.com")||t.includes("oss-"),process:(t,o)=>{const{width:n,height:a,quality:r,format:s}=o,c=[];return(n||a)&&c.push(`resize,w_${n||""},h_${a||""},m_lfit`),r&&c.push(`quality,q_${r}`),s&&c.push(`format,${s}`),c.length>0&&t.searchParams.set("x-oss-process",c.join("/")),t.toString()}},tencent:{test:t=>t.includes("qcloud.com")||t.includes("myqcloud.com"),process:(t,o)=>{const{width:n,height:a,quality:r,format:s}=o,c=[];if((n||a)&&c.push(`imageMogr2/thumbnail/${n}x${a}`),r&&c.push(`quality/${r}`),s&&c.push(`format/${s}`),c.length>0){const l=c.join("|"),f=t.search?"|":"?imageMogr2/";return`${t.toString()}${f}${l}`}return t.toString()}},qiniu:{test:t=>t.includes("qiniucdn.com")||t.includes("qiniu.com"),process:(t,o)=>{const{width:n,height:a,quality:r,format:s}=o,c=[];if((n||a)&&c.push(`imageView2/1/w/${n||""}/h/${a||""}`),r&&c.push(`quality/${r}`),s&&c.push(`format/${s}`),c.length>0){const l=c.join("|"),f=t.search?"|":"?";return`${t.toString()}${f}${l}`}return t.toString()}},upyun:{test:t=>t.includes("upaiyun.com")||t.includes("upyun.com"),process:(t,o)=>{const{width:n,height:a,quality:r,format:s}=o,c=[];if((n||a)&&c.push(`${n||""}x${a||""}`),r&&c.push(`quality/${r}`),s&&c.push(`format/${s}`),c.length>0){const l=t.pathname.split("/"),f=l[l.length-1],g=l.slice(0,-1).join("/")+"/!"+c.join("/")+"/"+f;t.pathname=g}return t.toString()}},cloudfront:{test:t=>t.includes("cloudfront.net")||t.includes(".aws"),process:(t,o)=>{const{width:n,height:a,quality:r,format:s}=o;return n&&t.searchParams.set("w",n),a&&t.searchParams.set("h",a),r&&t.searchParams.set("q",r),s&&t.searchParams.set("f",s),t.toString()}}};function we(t,o={}){if(!t)return t;const{width:n=null,height:a=null,quality:r=30,format:s=null,autoFormat:c=!0}=o;try{let l;try{l=new URL(t)}catch{if(t.startsWith("/")){const I=typeof window<"u"&&window.location?window.location.origin:"https://example.com";l=new URL(t,I)}else return console.warn("无法解析的图片URL，跳过优化:",t),t}let f=s;c&&!s?f=Be():s&&(f=Be(s));for(const[u,I]of Object.entries(Ct))if(I.test(t))return I.process(l,{width:n,height:a,quality:r,format:f});return n&&l.searchParams.set("w",n),a&&l.searchParams.set("h",a),r&&l.searchParams.set("q",r),f&&l.searchParams.set("f",f),l.toString()}catch(l){return console.warn("图片URL优化失败:",l),t}}function nt(t,o={}){if(!t)return"";const{widths:n=null,aspectRatio:a=null,quality:r=80,format:s=null,autoFormat:c=!0}=o;return(n||[320,640,960,1280,1920]).map(u=>`${we(t,{width:u,height:a?Math.round(u/a):null,quality:r,format:s,autoFormat:c})} ${u}w`).join(", ")}function Ae(t={}){const{breakpoints:o=["(max-width: 640px) 100vw","(max-width: 1024px) 50vw","33vw"]}=t;return Array.isArray(o)?o.join(", "):o}function xt(t,o={}){if(!t)return{src:"",srcset:"",sizes:""};const{widths:n=null,aspectRatio:a=null,quality:r=80,format:s=null,autoFormat:c=!0,sizes:l=null,fallbackWidth:f=960}=o,g=nt(t,{widths:n,aspectRatio:a,quality:r,format:s,autoFormat:c}),u=l?typeof l=="string"?l:Ae(l):Ae();return{src:we(t,{width:f,height:a?Math.round(f/a):null,quality:r,format:s,autoFormat:c}),srcset:g,sizes:u}}function Pt(t){return we(t,{width:240,height:320,quality:75})}function at(t){return new Promise(o=>{if(!t){o(!1);return}const n=new Image;n.onload=()=>o(!0),n.onerror=()=>o(!1),n.src=t})}async function _t(t,o=3){const n=[],a=[...t],r=async()=>{for(;a.length>0;){const c=a.shift(),l=await at(c);n.push({url:c,success:l})}},s=Array(Math.min(o,t.length)).fill(null).map(()=>r());return await Promise.all(s),n}async function ot(t,o={}){const{concurrency:n=10,timeout:a=3e4,priority:r=!0,stages:s=null,enableCache:c=!0,urlTransformer:l=null,onStageError:f=null,onProgress:g=null,onItemComplete:u=null,onItemStageComplete:I=null,retryOnError:w=!1,maxRetries:p=1}=o,y=t.map((v,z)=>typeof v=="string"?{url:v,priority:0,index:z}:{url:v.url||v.src||"",priority:v.priority||0,index:v.index!==void 0?v.index:z});r&&y.sort((v,z)=>z.priority-v.priority);const R=new Array(y.length);let q=0;const h=y.length,d=async(v,z=0)=>{const{url:O,index:M}=v;if(!O){const b={url:"",success:!1,error:new Error("图片URL为空"),index:M,retries:z};return R[M]=b,q++,g&&g(q,h,b),u&&u(b),b}if(s&&Array.isArray(s)&&s.length>0){const{loadImageProgressiveWithCache:C}=await Promise.resolve().then(()=>Qt);return C(O,{stages:s,timeout:a,enableCache:c,urlTransformer:l,onStageError:f,onStageComplete:(b,U,J)=>{I&&I({url:O,index:M,stageIndex:b,stageUrl:U,stage:J,currentStage:b+1,totalStages:s.length},b)},onComplete:b=>{},onError:(b,U)=>{}}).then(b=>{const U={url:b.url,success:b.success,error:b.error,index:M,retries:z,stages:b.stages,fromCache:b.fromCache||!1};return R[M]=U,q++,g&&g(q,h,U),u&&u(U),U})}return new Promise(C=>{const b=new Image;let U=!1,J=null;const ee=()=>{J&&(clearTimeout(J),J=null),b.onload=null,b.onerror=null,b.src=""},W=(N,Y=null)=>{if(U)return null;U=!0,ee();const Z={url:O,success:N,error:Y,index:M,retries:z};return R[M]=Z,q++,g&&g(q,h,Z),u&&u(Z),Z};J=setTimeout(()=>{const N=new Error(`图片加载超时 (${a}ms)`),Y=W(!1,N);w&&z<p?setTimeout(()=>{d(v,z+1).then(C)},1e3*(z+1)):C(Y)},a),b.onload=()=>{const N=W(!0,null);N&&C(N)},b.onerror=N=>{const Y=new Error("图片加载失败");Y.originalEvent=N;const Z=W(!1,Y);w&&z<p?setTimeout(()=>{d(v,z+1).then(C)},1e3*(z+1)):C(Z)};try{b.crossOrigin="anonymous",b.src=O}catch(N){const Y=W(!1,N);Y&&C(Y)}})},S=[...y],x=new Set,j=[];return await(async()=>{for(;S.length>0||x.size>0;){for(;S.length>0&&x.size<n;){const v=S.shift(),z=d(v).then(O=>(x.delete(z),O)).catch(O=>{x.delete(z);const M={url:v.url,success:!1,error:O instanceof Error?O:new Error(String(O)),index:v.index,retries:0};return R[v.index]=M,q++,g&&g(q,h,M),u&&u(M),M});x.add(z),j.push(z)}x.size>0&&await Promise.race(Array.from(x))}})(),await Promise.all(j),R}async function It(t,o={}){return ot(t,{priority:!1,...o})}function st(t,o={}){if(!t)return t;const{width:n=20,height:a=null,quality:r=20,blur:s=10}=o;return we(t,{width:n,height:a,quality:r,format:"jpg"})}async function it(t,o={}){var I;const{stages:n=[{width:20,quality:20,blur:10},{width:400,quality:50,blur:3},{width:null,quality:80,blur:0}],timeout:a=3e4,urlTransformer:r=null,onStageComplete:s=null,onStageError:c=null,onComplete:l=null,onError:f=null}=o;if(!t){const w=new Error("图片URL为空");return f&&f(w,-1),{url:"",stages:[],success:!1,error:w}}const g=[];let u=t;try{for(let p=0;p<n.length;p++){const y=n[p];let R;r&&typeof r=="function"?R=r(t,y,p):p===n.length-1&&!y.width&&!y.height?R=t:R=we(t,{width:y.width||null,height:y.height||null,quality:y.quality||80,format:y.format||null,autoFormat:y.autoFormat!==!1});let q;try{q=await new Promise((h,d)=>{const S=new Image;let x=null,j=!1;const L=()=>{x&&(clearTimeout(x),x=null),S.onload=null,S.onerror=null,S.src=""};x=setTimeout(()=>{if(!j){j=!0,L();const v=new Error(`阶段 ${p+1} 加载超时: ${R}`);d(v)}},a),S.onload=()=>{j||(j=!0,L(),h({url:R,stage:y,loaded:!0}))},S.onerror=v=>{if(!j){j=!0,L();let z=`阶段 ${p+1} 加载失败`;try{if(v.target&&v.target.src){const M=v.target.src;z=`阶段 ${p+1} 加载失败`}}catch{}const O=new Error(z);O.originalEvent=v,O.stageUrl=R,O.stageIndex=p,d(O)}};try{S.crossOrigin="anonymous",S.src=R}catch(v){j||(j=!0,L(),d(v))}}),g.push(q),u=R,s&&s(p,R,y)}catch(h){let d=null;if(c&&typeof c=="function")try{d=c(h,p,R,y)}catch{}if(d&&typeof d=="string")try{const x=await new Promise((j,L)=>{const v=new Image;let z=null,O=!1;const M=()=>{z&&(clearTimeout(z),z=null),v.onload=null,v.onerror=null,v.src=""};z=setTimeout(()=>{O||(O=!0,M(),L(new Error(`降级URL加载超时: ${d}`)))},a),v.onload=()=>{O||(O=!0,M(),j({url:d,stage:y,loaded:!0}))},v.onerror=()=>{O||(O=!0,M(),L(new Error(`降级URL加载失败: ${d}`)))};try{v.crossOrigin="anonymous",v.src=d}catch(C){O||(O=!0,M(),L(C))}});g.push(x),u=d,s&&s(p,d,y);break}catch{}const S=h.message.includes("404")||h.originalEvent&&h.originalEvent.type==="error";if((!S||process.env.NODE_ENV==="development")&&(S||console.warn(`⚠️ 阶段 ${p+1} 加载失败，跳过继续下一阶段:`,h.message)),g.push({url:R,stage:y,loaded:!1,error:h}),p===n.length-1&&g.length>0){for(let x=g.length-1;x>=0;x--)if(g[x].loaded){u=g[x].url;break}}if(s&&s(p,R,y),!(p<n.length-1)){if(!g.some(x=>x.loaded))throw new Error(`所有阶段加载失败，最后一个错误: ${h.message}`)}}p<n.length-1&&await new Promise(h=>setTimeout(h,100))}if(!g.some(p=>p.loaded)){const p=((I=g[g.length-1])==null?void 0:I.error)||new Error("所有阶段加载失败"),y=p.message.includes("404")||p.originalEvent&&p.originalEvent.type==="error";return(!y||process.env.NODE_ENV==="development")&&(y||console.error(`❌ 图片加载失败: ${t.substring(0,50)}...`,p.message)),f&&f(p,g.length-1),{url:u||t,stages:g,success:!1,error:p}}return l&&l(u),{url:u,stages:g,success:!0,error:null}}catch(w){const p=g.length,y=w.message&&w.message.includes("404");return(!y||process.env.NODE_ENV==="development")&&(y||console.error(`❌ 渐进式加载过程出错: ${t.substring(0,50)}...`,w.message||w)),f&&f(w,p),{url:u||t,stages:g,success:!1,error:w}}}async function jt(t,o={}){const{stages:n=[{width:20,quality:20,blur:10},{width:400,quality:50,blur:3},{width:null,quality:80,blur:0}],concurrency:a=5,timeout:r=3e4,onProgress:s=null,onItemStageComplete:c=null,onItemComplete:l=null}=o,f=t.map((h,d)=>typeof h=="string"?{url:h,index:d}:{url:h.url||h.src||"",index:h.index!==void 0?h.index:d}),g=new Array(f.length);let u=0;const I=f.length,w=async h=>{const{url:d,index:S}=h,x=await it(d,{stages:n,timeout:r,onStageComplete:(j,L,v)=>{c&&c({url:d,index:S,stageIndex:j,stageUrl:L,stage:v,currentStage:j+1,totalStages:n.length},j)},onComplete:j=>{},onError:(j,L)=>{}});return g[S]=x,u++,s&&s(u,I,x),l&&l(x),x},p=[...f],y=new Set,R=[];return await(async()=>{for(;p.length>0||y.size>0;){for(;p.length>0&&y.size<a;){const h=p.shift(),d=w(h).then(S=>(y.delete(d),S)).catch(S=>{y.delete(d);const x={url:h.url,stages:[],success:!1,error:S instanceof Error?S:new Error(String(S))};return g[h.index]=x,u++,s&&s(u,I,x),l&&l(x),x});y.add(d),R.push(d)}y.size>0&&await Promise.race(Array.from(y))}})(),await Promise.all(R),g}async function lt(t,o={}){const{maxWidth:n=null,maxHeight:a=null,quality:r=.8,compressionLevel:s=.5,blur:c=0,smooth:l=!0,format:f=null}=o;if(typeof window>"u"||typeof document>"u")throw new Error("浏览器端压缩功能仅在浏览器环境中可用");return new Promise((g,u)=>{const I=new Image;if(I.crossOrigin="anonymous",I.onload=()=>{try{let{width:w,height:p}=I,y=w,R=p,q=!1;if(n||a){const C=Math.min(n?n/w:1,a?a/p:1);C<1&&(y=Math.round(w*C),R=Math.round(p*C),q=!0)}let h=y,d=R;if(s>0){const C=1-s*.75;h=Math.round(y*C),d=Math.round(R*C)}const S=h!==w||d!==p;if(!(S||s>0||c>0)&&typeof t=="string"){g(t);return}const j=document.createElement("canvas");j.width=h,j.height=d;const L=j.getContext("2d");if(S?(L.imageSmoothingEnabled=l,L.imageSmoothingQuality=l?"high":"low"):L.imageSmoothingEnabled=!1,L.drawImage(I,0,0,h,d),c>0){const C=document.createElement("canvas"),b=C.getContext("2d");if(C.width=h,C.height=d,b.drawImage(I,0,0,h,d),b.filter!==void 0)try{b.filter=`blur(${c}px)`,b.drawImage(C,0,0),b.filter="none",L.clearRect(0,0,j.width,j.height),L.drawImage(C,0,0)}catch{St(L,C,h,d,c)}else St(L,C,h,d,c)}let v=f;if(!v)if(s>0||c>0||S)v=$e().includes("webp")?"webp":"jpeg";else{const b=rt(t);b&&["jpg","jpeg","png"].includes(b)?v=b==="jpeg"?"jpeg":b:v=$e().includes("webp")?"webp":"jpeg"}let z=r;s>0?(z=r*(1-s*.7),z=Math.max(.1,Math.min(1,z))):!S&&c===0?z=Math.max(r,.98):S&&(z=Math.max(r,.92));const O=v==="webp"?"image/webp":v==="png"?"image/png":"image/jpeg",M=j.toDataURL(O,z);g(M)}catch(w){u(new Error("图片压缩失败: "+w.message))}},I.onerror=()=>{u(new Error("图片加载失败"))},typeof t=="string")I.src=t;else if(t instanceof File||t instanceof Blob){const w=new FileReader;w.onload=p=>{I.src=p.target.result},w.onerror=()=>u(new Error("文件读取失败")),w.readAsDataURL(t)}else u(new Error("不支持的图片源类型"))})}function St(t,o,n,a,r){const s=document.createElement("canvas"),c=s.getContext("2d"),l=Math.max(.3,1-r/10),f=Math.round(n*l),g=Math.round(a*l);s.width=f,s.height=g,c.drawImage(o,0,0,n,a,0,0,f,g),t.clearRect(0,0,n,a),t.drawImage(s,0,0,f,g,0,0,n,a)}function ct(t){const o=t.split(","),n=o[0].match(/:(.*?);/)[1],a=atob(o[1]);let r=a.length;const s=new Uint8Array(r);for(;r--;)s[r]=a.charCodeAt(r);return new Blob([s],{type:n})}async function Ne(t){if(!t)return null;try{if(t.startsWith("blob:"))return(await(await fetch(t)).blob()).size;if(t.startsWith("data:")){const a=t.split(",")[1];if(a){const r=atob(a);return new Blob([r]).size}return null}try{const r=(await fetch(t,{method:"HEAD"})).headers.get("Content-Length");if(r)return parseInt(r,10)}catch{}return(await(await fetch(t)).blob()).size}catch{return null}}function Ue(t){if(t==null)return"未知";if(t===0)return"0 B";const o=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(o));return parseFloat((t/Math.pow(o,a)).toFixed(2))+" "+n[a]}function xe(t){if(!t)return null;for(const[o,n]of Object.entries(Ct))if(n.test(t))return o;return null}async function ut(t,o){const[n,a]=await Promise.all([Ne(t),Ne(o)]);let r=null,s=null,c=!1,l=null;return n!==null&&a!==null&&(r=n-a,s=parseFloat((r/n*100).toFixed(2)),c=r>1024||s>1,!c&&r===0?xe(t)?l="⚠️ 优化参数可能无效，图片大小未发生变化。请检查CDN配置是否正确。":l="⚠️ 该图片URL不是支持的CDN，通用查询参数可能无效。支持的CDN：阿里云OSS、腾讯云COS、七牛云、又拍云、AWS CloudFront。":!c&&r>0&&s<=1&&(l=`⚠️ 优化效果不明显（仅节省 ${s}%），可能优化参数未生效。`)),{originalUrl:t,optimizedUrl:o,originalSize:n,optimizedSize:a,savedSize:r,savedPercentage:s,isOptimizationEffective:c,warningMessage:l,originalSizeFormatted:Ue(n),optimizedSizeFormatted:Ue(a),savedSizeFormatted:Ue(r),cdn:xe(t)}}const Yt=Object.freeze(Object.defineProperty({__proto__:null,compareImageSizes:ut,compressImageInBrowser:lt,dataURLToBlob:ct,detectCDN:xe,detectImageFormat:rt,detectSupportedFormats:$e,formatFileSize:Ue,generateBlurPlaceholderUrl:st,generateResponsiveImage:xt,generateSizes:Ae,generateSrcset:nt,getBestFormat:Be,getImageSize:Ne,getOptimizedCoverUrl:Pt,loadImageProgressive:it,loadImagesBatch:It,loadImagesProgressiveBatch:jt,loadImagesProgressively:ot,optimizeImageUrl:we,preloadImage:at,preloadImages:_t},Symbol.toStringTag,{value:"Module"}));var tt={exports:{}},Oe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Et;function Kt(){if(Et)return Oe;Et=1;var t=T,o=Symbol.for("react.element"),n=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(l,f,g){var u,I={},w=null,p=null;g!==void 0&&(w=""+g),f.key!==void 0&&(w=""+f.key),f.ref!==void 0&&(p=f.ref);for(u in f)a.call(f,u)&&!s.hasOwnProperty(u)&&(I[u]=f[u]);if(l&&l.defaultProps)for(u in f=l.defaultProps,f)I[u]===void 0&&(I[u]=f[u]);return{$$typeof:o,type:l,key:w,ref:p,props:I,_owner:r.current}}return Oe.Fragment=n,Oe.jsx=c,Oe.jsxs=c,Oe}var Fe={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rt;function Jt(){return Rt||(Rt=1,process.env.NODE_ENV!=="production"&&function(){var t=T,o=Symbol.for("react.element"),n=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),l=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),u=Symbol.for("react.suspense_list"),I=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),p=Symbol.for("react.offscreen"),y=Symbol.iterator,R="@@iterator";function q(e){if(e===null||typeof e!="object")return null;var i=y&&e[y]||e[R];return typeof i=="function"?i:null}var h=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function d(e){{for(var i=arguments.length,m=new Array(i>1?i-1:0),E=1;E<i;E++)m[E-1]=arguments[E];S("error",e,m)}}function S(e,i,m){{var E=h.ReactDebugCurrentFrame,D=E.getStackAddendum();D!==""&&(i+="%s",m=m.concat([D]));var A=m.map(function($){return String($)});A.unshift("Warning: "+i),Function.prototype.apply.call(console[e],console,A)}}var x=!1,j=!1,L=!1,v=!1,z=!1,O;O=Symbol.for("react.module.reference");function M(e){return!!(typeof e=="string"||typeof e=="function"||e===a||e===s||z||e===r||e===g||e===u||v||e===p||x||j||L||typeof e=="object"&&e!==null&&(e.$$typeof===w||e.$$typeof===I||e.$$typeof===c||e.$$typeof===l||e.$$typeof===f||e.$$typeof===O||e.getModuleId!==void 0))}function C(e,i,m){var E=e.displayName;if(E)return E;var D=i.displayName||i.name||"";return D!==""?m+"("+D+")":m}function b(e){return e.displayName||"Context"}function U(e){if(e==null)return null;if(typeof e.tag=="number"&&d("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case a:return"Fragment";case n:return"Portal";case s:return"Profiler";case r:return"StrictMode";case g:return"Suspense";case u:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case l:var i=e;return b(i)+".Consumer";case c:var m=e;return b(m._context)+".Provider";case f:return C(e,e.render,"ForwardRef");case I:var E=e.displayName||null;return E!==null?E:U(e.type)||"Memo";case w:{var D=e,A=D._payload,$=D._init;try{return U($(A))}catch{return null}}}return null}var J=Object.assign,ee=0,W,N,Y,Z,X,le,ye;function he(){}he.__reactDisabledLog=!0;function ke(){{if(ee===0){W=console.log,N=console.info,Y=console.warn,Z=console.error,X=console.group,le=console.groupCollapsed,ye=console.groupEnd;var e={configurable:!0,enumerable:!0,value:he,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}ee++}}function ve(){{if(ee--,ee===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:J({},e,{value:W}),info:J({},e,{value:N}),warn:J({},e,{value:Y}),error:J({},e,{value:Z}),group:J({},e,{value:X}),groupCollapsed:J({},e,{value:le}),groupEnd:J({},e,{value:ye})})}ee<0&&d("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var pe=h.ReactCurrentDispatcher,ae;function be(e,i,m){{if(ae===void 0)try{throw Error()}catch(D){var E=D.stack.trim().match(/\n( *(at )?)/);ae=E&&E[1]||""}return`
`+ae+e}}var ce=!1,ge;{var Se=typeof WeakMap=="function"?WeakMap:Map;ge=new Se}function de(e,i){if(!e||ce)return"";{var m=ge.get(e);if(m!==void 0)return m}var E;ce=!0;var D=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var A;A=pe.current,pe.current=null,ke();try{if(i){var $=function(){throw Error()};if(Object.defineProperty($.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct($,[])}catch(ne){E=ne}Reflect.construct(e,[],$)}else{try{$.call()}catch(ne){E=ne}e.call($.prototype)}}else{try{throw Error()}catch(ne){E=ne}e()}}catch(ne){if(ne&&E&&typeof ne.stack=="string"){for(var F=ne.stack.split(`
`),re=E.stack.split(`
`),H=F.length-1,K=re.length-1;H>=1&&K>=0&&F[H]!==re[K];)K--;for(;H>=1&&K>=0;H--,K--)if(F[H]!==re[K]){if(H!==1||K!==1)do if(H--,K--,K<0||F[H]!==re[K]){var ie=`
`+F[H].replace(" at new "," at ");return e.displayName&&ie.includes("<anonymous>")&&(ie=ie.replace("<anonymous>",e.displayName)),typeof e=="function"&&ge.set(e,ie),ie}while(H>=1&&K>=0);break}}}finally{ce=!1,pe.current=A,ve(),Error.prepareStackTrace=D}var Ie=e?e.displayName||e.name:"",Ce=Ie?be(Ie):"";return typeof e=="function"&&ge.set(e,Ce),Ce}function Ee(e,i,m){return de(e,!1)}function te(e){var i=e.prototype;return!!(i&&i.isReactComponent)}function ue(e,i,m){if(e==null)return"";if(typeof e=="function")return de(e,te(e));if(typeof e=="string")return be(e);switch(e){case g:return be("Suspense");case u:return be("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case f:return Ee(e.render);case I:return ue(e.type,i,m);case w:{var E=e,D=E._payload,A=E._init;try{return ue(A(D),i,m)}catch{}}}return""}var oe=Object.prototype.hasOwnProperty,je={},Re=h.ReactDebugCurrentFrame;function me(e){if(e){var i=e._owner,m=ue(e.type,e._source,i?i.type:null);Re.setExtraStackFrame(m)}else Re.setExtraStackFrame(null)}function qe(e,i,m,E,D){{var A=Function.call.bind(oe);for(var $ in e)if(A(e,$)){var F=void 0;try{if(typeof e[$]!="function"){var re=Error((E||"React class")+": "+m+" type `"+$+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[$]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw re.name="Invariant Violation",re}F=e[$](i,$,E,m,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(H){F=H}F&&!(F instanceof Error)&&(me(D),d("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",E||"React class",m,$,typeof F),me(null)),F instanceof Error&&!(F.message in je)&&(je[F.message]=!0,me(D),d("Failed %s type: %s",m,F.message),me(null))}}}var Ke=Array.isArray;function ze(e){return Ke(e)}function Je(e){{var i=typeof Symbol=="function"&&Symbol.toStringTag,m=i&&e[Symbol.toStringTag]||e.constructor.name||"Object";return m}}function fe(e){try{return se(e),!1}catch{return!0}}function se(e){return""+e}function De(e){if(fe(e))return d("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",Je(e)),se(e)}var k=h.ReactCurrentOwner,P={key:!0,ref:!0,__self:!0,__source:!0},B,_;function G(e){if(oe.call(e,"ref")){var i=Object.getOwnPropertyDescriptor(e,"ref").get;if(i&&i.isReactWarning)return!1}return e.ref!==void 0}function Te(e){if(oe.call(e,"key")){var i=Object.getOwnPropertyDescriptor(e,"key").get;if(i&&i.isReactWarning)return!1}return e.key!==void 0}function Pe(e,i){typeof e.ref=="string"&&k.current}function Ze(e,i){{var m=function(){B||(B=!0,d("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",i))};m.isReactWarning=!0,Object.defineProperty(e,"key",{get:m,configurable:!0})}}function Ut(e,i){{var m=function(){_||(_=!0,d("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",i))};m.isReactWarning=!0,Object.defineProperty(e,"ref",{get:m,configurable:!0})}}var $t=function(e,i,m,E,D,A,$){var F={$$typeof:o,type:e,key:i,ref:m,props:$,_owner:A};return F._store={},Object.defineProperty(F._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(F,"_self",{configurable:!1,enumerable:!1,writable:!1,value:E}),Object.defineProperty(F,"_source",{configurable:!1,enumerable:!1,writable:!1,value:D}),Object.freeze&&(Object.freeze(F.props),Object.freeze(F)),F};function Lt(e,i,m,E,D){{var A,$={},F=null,re=null;m!==void 0&&(De(m),F=""+m),Te(i)&&(De(i.key),F=""+i.key),G(i)&&(re=i.ref,Pe(i,D));for(A in i)oe.call(i,A)&&!P.hasOwnProperty(A)&&($[A]=i[A]);if(e&&e.defaultProps){var H=e.defaultProps;for(A in H)$[A]===void 0&&($[A]=H[A])}if(F||re){var K=typeof e=="function"?e.displayName||e.name||"Unknown":e;F&&Ze($,K),re&&Ut($,K)}return $t(e,F,re,D,E,k.current,$)}}var Ge=h.ReactCurrentOwner,gt=h.ReactDebugCurrentFrame;function _e(e){if(e){var i=e._owner,m=ue(e.type,e._source,i?i.type:null);gt.setExtraStackFrame(m)}else gt.setExtraStackFrame(null)}var Qe;Qe=!1;function Xe(e){return typeof e=="object"&&e!==null&&e.$$typeof===o}function ht(){{if(Ge.current){var e=U(Ge.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function kt(e){return""}var pt={};function qt(e){{var i=ht();if(!i){var m=typeof e=="string"?e:e.displayName||e.name;m&&(i=`

Check the top-level render call using <`+m+">.")}return i}}function wt(e,i){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var m=qt(i);if(pt[m])return;pt[m]=!0;var E="";e&&e._owner&&e._owner!==Ge.current&&(E=" It was passed a child from "+U(e._owner.type)+"."),_e(e),d('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',m,E),_e(null)}}function yt(e,i){{if(typeof e!="object")return;if(ze(e))for(var m=0;m<e.length;m++){var E=e[m];Xe(E)&&wt(E,i)}else if(Xe(e))e._store&&(e._store.validated=!0);else if(e){var D=q(e);if(typeof D=="function"&&D!==e.entries)for(var A=D.call(e),$;!($=A.next()).done;)Xe($.value)&&wt($.value,i)}}}function Dt(e){{var i=e.type;if(i==null||typeof i=="string")return;var m;if(typeof i=="function")m=i.propTypes;else if(typeof i=="object"&&(i.$$typeof===f||i.$$typeof===I))m=i.propTypes;else return;if(m){var E=U(i);qe(m,e.props,"prop",E,e)}else if(i.PropTypes!==void 0&&!Qe){Qe=!0;var D=U(i);d("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",D||"Unknown")}typeof i.getDefaultProps=="function"&&!i.getDefaultProps.isReactClassApproved&&d("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Mt(e){{for(var i=Object.keys(e.props),m=0;m<i.length;m++){var E=i[m];if(E!=="children"&&E!=="key"){_e(e),d("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",E),_e(null);break}}e.ref!==null&&(_e(e),d("Invalid attribute `ref` supplied to `React.Fragment`."),_e(null))}}var vt={};function bt(e,i,m,E,D,A){{var $=M(e);if(!$){var F="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(F+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var re=kt();re?F+=re:F+=ht();var H;e===null?H="null":ze(e)?H="array":e!==void 0&&e.$$typeof===o?(H="<"+(U(e.type)||"Unknown")+" />",F=" Did you accidentally export a JSX literal instead of a component?"):H=typeof e,d("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",H,F)}var K=Lt(e,i,m,D,A);if(K==null)return K;if($){var ie=i.children;if(ie!==void 0)if(E)if(ze(ie)){for(var Ie=0;Ie<ie.length;Ie++)yt(ie[Ie],e);Object.freeze&&Object.freeze(ie)}else d("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else yt(ie,e)}if(oe.call(i,"key")){var Ce=U(e),ne=Object.keys(i).filter(function(Ht){return Ht!=="key"}),et=ne.length>0?"{key: someKey, "+ne.join(": ..., ")+": ...}":"{key: someKey}";if(!vt[Ce+et]){var Vt=ne.length>0?"{"+ne.join(": ..., ")+": ...}":"{}";d(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,et,Ce,Vt,Ce),vt[Ce+et]=!0}}return e===a?Mt(K):Dt(K),K}}function Bt(e,i,m){return bt(e,i,m,!0)}function At(e,i,m){return bt(e,i,m,!1)}var Nt=At,Wt=Bt;Fe.Fragment=a,Fe.jsx=Nt,Fe.jsxs=Wt}()),Fe}process.env.NODE_ENV==="production"?tt.exports=Kt():tt.exports=Jt();var V=tt.exports;const Zt="ImageOptimizeCache",Gt=1,Q="imageCache",zt=30*24*60*60*1e3;let Me=null;const Le=()=>new Promise((t,o)=>{if(Me){t(Me);return}const n=indexedDB.open(Zt,Gt);n.onerror=()=>{console.error("❌ IndexedDB 打开失败:",n.error),o(n.error)},n.onsuccess=()=>{Me=n.result,t(Me)},n.onupgradeneeded=a=>{const r=a.target.result;r.objectStoreNames.contains(Q)||r.createObjectStore(Q,{keyPath:"url"}).createIndex("timestamp","timestamp",{unique:!1})}}),Ve=async t=>{try{const o=await Le();if(!o.objectStoreNames.contains(Q))return null;const r=o.transaction([Q],"readonly").objectStore(Q).get(t);return new Promise((s,c)=>{r.onsuccess=()=>{const l=r.result;if(l&&Date.now()-l.timestamp<zt){const f=new Uint8Array(l.data);s({data:f,timestamp:l.timestamp,mimeType:l.mimeType||"image/jpeg"})}else s(null)},r.onerror=()=>c(r.error)})}catch(o){return console.error("❌ 从 IndexedDB 读取图片缓存失败:",o),null}},He=async(t,o,n="image/jpeg")=>{try{const a=await Le();if(!a.objectStoreNames.contains(Q))return;const s=a.transaction([Q],"readwrite").objectStore(Q),c={url:t,data:o.buffer,timestamp:Date.now(),mimeType:n},l=s.put(c);return new Promise((f,g)=>{l.onsuccess=()=>{f()},l.onerror=()=>g(l.error)})}catch(a){console.error("❌ 保存图片缓存到 IndexedDB 失败:",a)}},Ye=async t=>{try{const o=await Le();if(!o.objectStoreNames.contains(Q))return;const a=o.transaction([Q],"readwrite").objectStore(Q);if(t){const r=a.delete(t);return new Promise((s,c)=>{r.onsuccess=()=>{s()},r.onerror=()=>c(r.error)})}else{const r=a.clear();return new Promise((s,c)=>{r.onsuccess=()=>{s()},r.onerror=()=>c(r.error)})}}catch(o){console.error("❌ 删除图片缓存失败:",o)}},ft=async()=>{try{const t=await Le();if(!t.objectStoreNames.contains(Q))return;const a=t.transaction([Q],"readwrite").objectStore(Q).index("timestamp"),r=Date.now(),s=IDBKeyRange.upperBound(r-zt),c=a.openCursor(s);return new Promise((l,f)=>{c.onsuccess=g=>{const u=g.target.result;u?(u.delete(),u.continue()):l()},c.onerror=()=>f(c.error)})}catch(t){console.error("❌ 清理过期图片缓存失败:",t)}},Tt=async()=>{try{const t=await Le();if(!t.objectStoreNames.contains(Q))return{count:0,totalSize:0,totalSizeMB:0};const a=t.transaction([Q],"readonly").objectStore(Q).getAll();return new Promise((r,s)=>{a.onsuccess=()=>{const c=a.result,l=c.reduce((f,g)=>f+(g.data?g.data.byteLength:0),0);r({count:c.length,totalSize:l,totalSizeMB:Math.round(l/1024/1024*100)/100})},a.onerror=()=>s(a.error)})}catch(t){return console.error("❌ 获取图片缓存统计失败:",t),{count:0,totalSize:0,totalSizeMB:0}}},We=(t,o)=>{try{const n=new Blob([t],{type:o});return URL.createObjectURL(n)}catch(n){return console.error("❌ 创建 Blob URL 失败:",n),null}},dt=async t=>{try{await ft();const o=await Ve(t);if(o){const l=We(o.data,o.mimeType);if(l)return l}const n=await fetch(t);if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const a=await n.arrayBuffer(),r=new Uint8Array(a),s=n.headers.get("Content-Type")||"image/jpeg";return await He(t,r,s),We(r,s)}catch(o){throw console.error("❌ 加载图片失败:",o),await Ye(t),o}},Ot=async t=>{await Ye(t)},mt=async(t,o={})=>{const{loadImageProgressive:n,optimizeImageUrl:a}=await Promise.resolve().then(()=>Yt),{stages:r=[{width:20,quality:20,blur:10},{width:400,quality:50,blur:3},{width:null,quality:80,blur:0}],timeout:s=3e4,enableCache:c=!0,urlTransformer:l=null,onStageComplete:f=null,onComplete:g=null,onError:u=null,onStageError:I=null}=o;if(!t){const w=new Error("图片URL为空");return u&&u(w,-1),{url:"",stages:[],success:!1,error:w,fromCache:!1}}try{if(!c)return{...await n(t,{stages:r,timeout:s,urlTransformer:l,onStageError:I,onStageComplete:f,onComplete:g,onError:u}),fromCache:!1};const w=r[r.length-1];let p=t;l&&typeof l=="function"?p=l(t,w,r.length-1):w&&(w.width||w.height)&&(p=a(t,{width:w.width||null,height:w.height||null,quality:w.quality||80,format:w.format||null,autoFormat:w.autoFormat!==!1}));const y=await Ve(p);if(y){const h=We(y.data,y.mimeType);if(h)return g&&g(h),f&&r.forEach((d,S)=>{S===r.length-1&&f(S,h,d)}),{url:h,stages:r.map((d,S)=>({url:S===r.length-1?h:"",stage:d,loaded:S===r.length-1})),success:!0,error:null,fromCache:!0}}const R=p;return{...await n(t,{stages:r,timeout:s,urlTransformer:l,onStageError:I,onStageComplete:f,onComplete:async h=>{if(h.startsWith("blob:"))console.log(`[渐进式加载缓存] 图片来自缓存，跳过保存: ${h.substring(0,30)}...`);else try{const d=await fetch(h);if(d.ok){const S=await d.arrayBuffer(),x=new Uint8Array(S),j=d.headers.get("Content-Type")||"image/jpeg";await He(R,x,j),console.log(`[渐进式加载缓存] 已保存到缓存: ${R.substring(0,50)}...`)}else console.warn(`[渐进式加载缓存] 响应状态码错误: ${d.status} - ${h.substring(0,50)}...`)}catch(d){console.warn("[渐进式加载缓存] 保存缓存失败:",d.message||d,h.substring(0,50))}g&&g(h)},onError:u}),fromCache:!1}}catch(w){const p=w.message&&w.message.includes("404");return(!p||process.env.NODE_ENV==="development")&&(p||console.error("❌ 渐进式加载图片失败:",w.message||w)),u&&u(w,-1),{url:"",stages:[],success:!1,error:w,fromCache:!1}}},Qt=Object.freeze(Object.defineProperty({__proto__:null,cleanExpiredImageCache:ft,clearImageCache:Ot,createBlobUrlFromCache:We,deleteImageCache:Ye,getImageCache:Ve,getImageCacheStats:Tt,loadImageProgressiveWithCache:mt,loadImageWithCache:dt,saveImageCache:He},Symbol.toStringTag,{value:"Module"}));function Ft({src:t="",alt:o="",width:n="100%",height:a="auto",className:r="",imageClassName:s="",dataId:c=null,imageStyle:l={},immediate:f=!1,rootMargin:g="50px",optimize:u={width:240,height:320,quality:30},enableBrowserCompression:I=!0,showPlaceholderIcon:w=!1,showErrorMessage:p=!1,errorSrc:y=null,progressive:R=!1,progressiveStages:q=[{width:20,quality:20,blur:10},{width:400,quality:50,blur:3},{width:null,quality:80,blur:0}],progressiveTransitionDuration:h=300,progressiveTimeout:d=3e4,progressiveEnableCache:S=!0,onLoad:x=null,onOptimization:j=null,onError:L=null,onClick:v=null,onProgressiveStageComplete:z=null}){const O=T.useRef(null),M=T.useRef(null),C=T.useRef(null),b=T.useRef(null),[U,J]=T.useState(!1),[ee,W]=T.useState(!1),[N,Y]=T.useState(!1),[Z,X]=T.useState(f),[le,ye]=T.useState(""),[he,ke]=T.useState(null),[ve,pe]=T.useState(!1),[ae,be]=T.useState(null),ce=T.useRef(null),[ge,Se]=T.useState(-1),[de,Ee]=T.useState(""),te=T.useRef(null),ue=T.useRef(-1),oe=T.useRef(!1),je=T.useRef(null),Re=k=>{if(!k)return"";try{if(u&&Object.keys(u).length>0){const P=we(k,u);if(P&&P.trim())return P}return k}catch(P){return console.warn("图片URL优化失败，使用原始URL:",P),k}},me=T.useMemo(()=>t?R&&de?de:he||ae||(U&&le?le:Re(t)):"",[t,U,le,u,he,ae,R,de]),qe=()=>{if(f||typeof window>"u"||!window.IntersectionObserver){X(!0);return}C.current&&(C.current.disconnect(),C.current=null),C.current=new IntersectionObserver(k=>{k.forEach(P=>{P.isIntersecting&&(X(!0),C.current&&P.target&&C.current.unobserve(P.target))})},{rootMargin:g,threshold:.01}),setTimeout(()=>{M.current&&C.current&&C.current.observe(M.current)},0)},Ke=async k=>{if(R){const _=ue.current;if(_>=0&&_<q.length)return}if(U)return;const P=k.target.src;if(J(!0),W(!1),Y(!1),ye(P),!P.startsWith("blob:")&&!P.startsWith("data:"))try{const _=Re(t),G=await fetch(_);if(G.ok){const Te=await G.arrayBuffer(),Pe=new Uint8Array(Te),Ze=G.headers.get("Content-Type")||"image/jpeg";await saveImageCache(_,Pe,Ze)}}catch(_){console.warn("保存图片缓存失败:",_)}let B=null;if(t&&P!==t)try{const _=await ut(t,P);_.originalSize!==null&&_.optimizedSize!==null?(B={originalUrl:_.originalUrl,originalSize:_.originalSize,originalSizeFormatted:_.originalSizeFormatted,optimizedUrl:_.optimizedUrl,optimizedSize:_.optimizedSize,optimizedSizeFormatted:_.optimizedSizeFormatted,savedSize:_.savedSize,savedSizeFormatted:_.savedSizeFormatted,savedPercentage:_.savedPercentage,cdn:_.cdn,isOptimizationEffective:_.isOptimizationEffective,warningMessage:_.warningMessage},b.current=B,j&&j(B),_.cdn,_.warningMessage&&console.warn(_.warningMessage),_.isOptimizationEffective):(B={originalUrl:t,optimizedUrl:P,originalSize:null,originalSizeFormatted:null,optimizedSize:null,optimizedSizeFormatted:null,savedSize:null,savedSizeFormatted:null,savedPercentage:null,cdn:xe(t),isOptimizationEffective:null,warningMessage:"⚠️ 无法获取图片大小（可能由于CORS限制）"},b.current=B,j&&j(B))}catch(_){console.warn("获取图片大小对比失败:",_),B={originalUrl:t,optimizedUrl:P,originalSize:null,originalSizeFormatted:null,optimizedSize:null,optimizedSizeFormatted:null,savedSize:null,savedSizeFormatted:null,savedPercentage:null,cdn:xe(t),isOptimizationEffective:null,warningMessage:`获取图片大小对比失败: ${_.message}`},b.current=B,j&&j(B)}x&&x(k,B)},ze=k=>{if(U)return;const P=k.target.src,B=Re(t);if(y&&(P===y||P.includes("videoCover.png"))){Y(!0),W(!1),L&&L(k);return}if(P===B&&B!==t){console.log("优化URL加载失败，尝试原始URL:",t),k.target.src=t;return}if(P===t||B===t){if(y&&P!==y){console.log("原始URL加载失败，尝试加载错误图片:",y),k.target.src=y;return}console.log("图片加载失败，显示错误占位符"),Y(!0),W(!1),L&&L(k)}},Je=k=>{var P;if(v){const B={src:t,currentSrc:((P=k.target)==null?void 0:P.src)||me,optimizedSrc:me,alt:o,dataId:c,isLoaded:U,isLoading:ee,hasError:N,isCompressing:ve,optimizationInfo:b.current,imageElement:k.target};v(k,B)}};T.useEffect(()=>{je.current=q},[q]);const fe=T.useRef(!1),se=T.useRef(null);T.useEffect(()=>{if(!R){fe.current=!1,se.current=null;return}if(se.current!==t&&(fe.current=!1,se.current=t),fe.current||!t||!Z)return;fe.current=!0,oe.current=!0,W(!0);let k=!1;const P=t,B=je.current||q;return te.current=()=>{k=!0,oe.current=!1,fe.current=!1},mt(P,{stages:B,timeout:d,enableCache:S,onStageComplete:(_,G,Te)=>{if(k||se.current!==P)return;const Pe=_+1;requestAnimationFrame(()=>{!k&&se.current===P&&(Se(Pe),ue.current=Pe,Ee(G),z&&z(_,G,Te))})},onComplete:_=>{k||se.current!==P||requestAnimationFrame(()=>{if(!k&&se.current===P){W(!1),Ee(_),oe.current=!1;const G=B.length;Se(G),ue.current=G}})},onError:(_,G)=>{k||se.current!==P||(console.warn(`[渐进式加载 ${P.substring(0,20)}...] 阶段 ${G+1} 失败:`,_.message||_),W(!1),oe.current=!1,fe.current=!1,Ee(""),Se(-1),ue.current=-1,W(!0))}}).catch(_=>{!k&&se.current===P&&(console.error(`[渐进式加载 ${P.substring(0,20)}...] 加载过程出错:`,_),W(!1),oe.current=!1,fe.current=!1,Ee(""),Se(-1),ue.current=-1)}),()=>{k=!0,oe.current=!1,fe.current=!1}},[R,Z,t,d,S]),T.useEffect(()=>{R||!R&&Z&&!U&&!N&&!ee&&!ve&&!ae&&!de&&t&&(async()=>{try{const P=Re(t),B=await dt(P);if(B)return be(B),ce.current=B,!0}catch{}return!1})().then(P=>{if(!P){const B=xe(t);I&&!B&&u&&Object.keys(u).length>0&&typeof window<"u"&&!he?(pe(!0),lt(t,{maxWidth:u.width||null,maxHeight:u.height||null,quality:u.quality?u.quality/100:.8,compressionLevel:u.compressionLevel!==void 0?u.compressionLevel:0,blur:u.blur!==void 0?u.blur:0,smooth:u.smooth!==void 0?u.smooth:!0,format:u.format||null}).then(G=>{ke(G),pe(!1),ct(G)}).catch(G=>{console.warn("浏览器端压缩失败，使用原始URL:",G),pe(!1)})):W(!0)}})},[Z,U,N,ee,ve,t,u,he,ae,I]),T.useEffect(()=>{ce.current&&(URL.revokeObjectURL(ce.current),ce.current=null),te.current&&(te.current(),te.current=null),J(!1),Y(!1),W(!1),ye(""),ke(null),pe(!1),be(null),te.current&&(te.current(),te.current=null),te.current&&(te.current(),te.current=null),Ee(""),Se(-1),ue.current=-1,oe.current=!1,fe.current=!1,se.current=null,b.current=null,f?X(!0):qe()},[t]),T.useEffect(()=>(f?X(!0):qe(),()=>{C.current&&(C.current.disconnect(),C.current=null),ce.current&&(URL.revokeObjectURL(ce.current),ce.current=null),te.current&&(te.current(),te.current=null)}),[]);const De={width:typeof n=="number"?`${n}px`:n,height:typeof a=="number"?`${a}px`:a};return V.jsxs("div",{ref:M,className:`image-optimize-container ${r}`.trim(),style:De,children:[!U&&!N&&!ee&&!ae&&!de&&V.jsx("div",{className:"image-optimize-placeholder",children:w&&V.jsx("svg",{className:"image-optimize-placeholder-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:V.jsx("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19ZM13.96 12.29L11.21 15.83L9.25 13.47L6.5 17H17.5L13.96 12.29Z",fill:"currentColor"})})}),(ee||ve)&&!N&&!ae&&!de&&V.jsxs("div",{className:"image-optimize-loading",children:[V.jsx("svg",{className:"image-optimize-loading-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:V.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeDasharray:"62.83",strokeDashoffset:"31.42"})}),ve&&V.jsx("span",{style:{marginTop:"8px",fontSize:"12px",color:"#666"},children:"正在压缩图片..."})]}),Z&&me&&V.jsx("img",{ref:O,src:me,alt:o,"data-id":c,className:`image-optimize-image ${s}`.trim(),style:{display:U||ae||de||!N&&me?"block":"none",transition:R?`opacity ${h}ms ease-in-out, filter ${h}ms ease-in-out`:void 0,opacity:R&&ge>=0||U||ae?1:0,filter:R?ge===1?"blur(10px)":ge===2?"blur(3px)":ge>=3?"blur(0px)":"blur(10px)":void 0,...l},onLoad:Ke,onError:ze,onClick:Je}),N&&V.jsxs("div",{className:"image-optimize-error",children:[V.jsx("svg",{className:"image-optimize-error-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:V.jsx("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19Z",fill:"currentColor"})}),p&&V.jsx("span",{className:"image-optimize-error-text",children:"加载失败"})]})]})}function Xt({src:t="",alt:o="",width:n="100%",height:a="auto",className:r="",imageClassName:s="",imageStyle:c={},stages:l=[{width:20,quality:20},{width:400,quality:50},{width:null,quality:80}],transitionDuration:f=300,timeout:g=3e4,enableCache:u=!0,showPlaceholder:I=!0,onStageComplete:w=null,onComplete:p=null,onError:y=null,onLoad:R=null}){const[q,h]=T.useState(-1),[d,S]=T.useState(""),[x,j]=T.useState(!1),[L,v]=T.useState(!1),[z,O]=T.useState(""),[M,C]=T.useState(!1),b=T.useRef(null),U=T.useRef(null);T.useEffect(()=>{var Y,Z;if(!t)return;const W=st(t,{width:((Y=l[0])==null?void 0:Y.width)||20,quality:((Z=l[0])==null?void 0:Z.quality)||20});S(W),h(0),j(!0),v(!1),O(""),C(!1);let N=!1;return mt(t,{stages:l,timeout:g,enableCache:u,onStageComplete:(X,le,ye)=>{N||(h(X+1),S(le),w&&w(X,le,ye))},onComplete:X=>{N||(j(!1),C(!0),S(X),p&&p(X))},onError:(X,le)=>{N||(j(!1),v(!0),O(X.message),y&&y(X,le))}}),()=>{N=!0}},[t,u]);const J={width:typeof n=="number"?`${n}px`:n,height:typeof a=="number"?`${a}px`:a,position:"relative",overflow:"hidden"},ee={width:"100%",height:"100%",objectFit:"cover",transition:`opacity ${f}ms ease-in-out, filter ${f}ms ease-in-out`,opacity:q>=0?1:0,filter:q===0?"blur(10px)":q===1?"blur(3px)":"blur(0px)",...c};return V.jsxs("div",{ref:b,className:`progressive-image-container ${r}`.trim(),style:J,children:[I&&q<0&&!L&&V.jsx("div",{className:"image-optimize-placeholder",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:V.jsx("svg",{className:"image-optimize-placeholder-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:V.jsx("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19ZM13.96 12.29L11.21 15.83L9.25 13.47L6.5 17H17.5L13.96 12.29Z",fill:"currentColor"})})}),d&&V.jsx("img",{ref:U,src:d,alt:o,className:`progressive-image ${s}`.trim(),style:ee,onLoad:W=>{M&&R&&R(W)},onError:W=>{L||(v(!0),O("图片加载失败"),y&&y(new Error("图片加载失败"),q))}}),L&&V.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",color:"#999",fontSize:"14px"},children:[V.jsx("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"❌"}),V.jsx("div",{children:z||"加载失败"})]}),x&&!L&&q<l.length&&V.jsxs("div",{style:{position:"absolute",bottom:"10px",right:"10px",backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},children:["阶段 ",q+1," / ",l.length]})]})}exports.LazyImage=Ft;exports.ProgressiveImage=Xt;exports.cleanExpiredImageCache=ft;exports.clearImageCache=Ot;exports.compareImageSizes=ut;exports.compressImageInBrowser=lt;exports.dataURLToBlob=ct;exports.default=Ft;exports.deleteImageCache=Ye;exports.detectCDN=xe;exports.detectImageFormat=rt;exports.detectSupportedFormats=$e;exports.formatFileSize=Ue;exports.generateBlurPlaceholderUrl=st;exports.generateResponsiveImage=xt;exports.generateSizes=Ae;exports.generateSrcset=nt;exports.getBestFormat=Be;exports.getImageCache=Ve;exports.getImageCacheStats=Tt;exports.getImageSize=Ne;exports.getOptimizedCoverUrl=Pt;exports.loadImageProgressive=it;exports.loadImageWithCache=dt;exports.loadImagesBatch=It;exports.loadImagesProgressiveBatch=jt;exports.loadImagesProgressively=ot;exports.optimizeImageUrl=we;exports.preloadImage=at;exports.preloadImages=_t;exports.saveImageCache=He;
