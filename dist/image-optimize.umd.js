(function(O,_){typeof exports=="object"&&typeof module<"u"?_(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],_):(O=typeof globalThis<"u"?globalThis:O||self,_(O.ImageOptimize={},O.React))})(this,function(O,_){"use strict";function ze(){const t=[];if(typeof window<"u"&&typeof document<"u"){const n=(()=>{try{const r=document.createElement("canvas");return r.width=1,r.height=1,r.toDataURL("image/webp").indexOf("data:image/webp")===0}catch{return!1}})();(()=>{try{const r=document.createElement("canvas");return r.width=1,r.height=1,r.toDataURL("image/avif").indexOf("data:image/avif")===0}catch{return!1}})()&&t.push("avif"),n&&t.push("webp")}return t.push("jpg","jpeg","png"),t}function Me(t=null){const o=ze();if(t){const n=t.toLowerCase().replace("jpeg","jpg");if(o.includes(n))return n}return o[0]||"jpg"}function Je(t){if(!t)return null;const n=t.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp|avif|bmp|svg)(\?|$)/i);if(n){const a=n[1].toLowerCase();return a==="jpeg"?"jpg":a}try{const a=new URL(t),r=a.searchParams.get("format")||a.searchParams.get("f")||a.searchParams.get("image_format");if(r)return r.toLowerCase().replace("jpeg","jpg")}catch{}return null}const ht={aliyun:{test:t=>t.includes("aliyuncs.com")||t.includes("oss-"),process:(t,o)=>{const{width:n,height:a,quality:r,format:s}=o,c=[];return(n||a)&&c.push(`resize,w_${n||""},h_${a||""},m_lfit`),r&&c.push(`quality,q_${r}`),s&&c.push(`format,${s}`),c.length>0&&t.searchParams.set("x-oss-process",c.join("/")),t.toString()}},tencent:{test:t=>t.includes("qcloud.com")||t.includes("myqcloud.com"),process:(t,o)=>{const{width:n,height:a,quality:r,format:s}=o,c=[];if((n||a)&&c.push(`imageMogr2/thumbnail/${n}x${a}`),r&&c.push(`quality/${r}`),s&&c.push(`format/${s}`),c.length>0){const l=c.join("|"),f=t.search?"|":"?imageMogr2/";return`${t.toString()}${f}${l}`}return t.toString()}},qiniu:{test:t=>t.includes("qiniucdn.com")||t.includes("qiniu.com"),process:(t,o)=>{const{width:n,height:a,quality:r,format:s}=o,c=[];if((n||a)&&c.push(`imageView2/1/w/${n||""}/h/${a||""}`),r&&c.push(`quality/${r}`),s&&c.push(`format/${s}`),c.length>0){const l=c.join("|"),f=t.search?"|":"?";return`${t.toString()}${f}${l}`}return t.toString()}},upyun:{test:t=>t.includes("upaiyun.com")||t.includes("upyun.com"),process:(t,o)=>{const{width:n,height:a,quality:r,format:s}=o,c=[];if((n||a)&&c.push(`${n||""}x${a||""}`),r&&c.push(`quality/${r}`),s&&c.push(`format/${s}`),c.length>0){const l=t.pathname.split("/"),f=l[l.length-1],g=l.slice(0,-1).join("/")+"/!"+c.join("/")+"/"+f;t.pathname=g}return t.toString()}},cloudfront:{test:t=>t.includes("cloudfront.net")||t.includes(".aws"),process:(t,o)=>{const{width:n,height:a,quality:r,format:s}=o;return n&&t.searchParams.set("w",n),a&&t.searchParams.set("h",a),r&&t.searchParams.set("q",r),s&&t.searchParams.set("f",s),t.toString()}}};function pe(t,o={}){if(!t)return t;const{width:n=null,height:a=null,quality:r=30,format:s=null,autoFormat:c=!0}=o;try{let l;try{l=new URL(t)}catch{if(t.startsWith("/")){const j=typeof window<"u"&&window.location?window.location.origin:"https://example.com";l=new URL(t,j)}else return console.warn("无法解析的图片URL，跳过优化:",t),t}let f=s;c&&!s?f=Me():s&&(f=Me(s));for(const[u,j]of Object.entries(ht))if(j.test(t))return j.process(l,{width:n,height:a,quality:r,format:f});return n&&l.searchParams.set("w",n),a&&l.searchParams.set("h",a),r&&l.searchParams.set("q",r),f&&l.searchParams.set("f",f),l.toString()}catch(l){return console.warn("图片URL优化失败:",l),t}}function Ze(t,o={}){if(!t)return"";const{widths:n=null,aspectRatio:a=null,quality:r=80,format:s=null,autoFormat:c=!0}=o;return(n||[320,640,960,1280,1920]).map(u=>`${pe(t,{width:u,height:a?Math.round(u/a):null,quality:r,format:s,autoFormat:c})} ${u}w`).join(", ")}function Be(t={}){const{breakpoints:o=["(max-width: 640px) 100vw","(max-width: 1024px) 50vw","33vw"]}=t;return Array.isArray(o)?o.join(", "):o}function pt(t,o={}){if(!t)return{src:"",srcset:"",sizes:""};const{widths:n=null,aspectRatio:a=null,quality:r=80,format:s=null,autoFormat:c=!0,sizes:l=null,fallbackWidth:f=960}=o,g=Ze(t,{widths:n,aspectRatio:a,quality:r,format:s,autoFormat:c}),u=l?typeof l=="string"?l:Be(l):Be();return{src:pe(t,{width:f,height:a?Math.round(f/a):null,quality:r,format:s,autoFormat:c}),srcset:g,sizes:u}}function wt(t){return pe(t,{width:240,height:320,quality:75})}function Ge(t){return new Promise(o=>{if(!t){o(!1);return}const n=new Image;n.onload=()=>o(!0),n.onerror=()=>o(!1),n.src=t})}async function yt(t,o=3){const n=[],a=[...t],r=async()=>{for(;a.length>0;){const c=a.shift(),l=await Ge(c);n.push({url:c,success:l})}},s=Array(Math.min(o,t.length)).fill(null).map(()=>r());return await Promise.all(s),n}async function Qe(t,o={}){const{concurrency:n=10,timeout:a=3e4,priority:r=!0,stages:s=null,enableCache:c=!0,urlTransformer:l=null,onStageError:f=null,onProgress:g=null,onItemComplete:u=null,onItemStageComplete:j=null,retryOnError:w=!1,maxRetries:p=1}=o,y=t.map((v,T)=>typeof v=="string"?{url:v,priority:0,index:T}:{url:v.url||v.src||"",priority:v.priority||0,index:v.index!==void 0?v.index:T});r&&y.sort((v,T)=>T.priority-v.priority);const R=new Array(y.length);let B=0;const h=y.length,d=async(v,T=0)=>{const{url:F,index:N}=v;if(!F){const b={url:"",success:!1,error:new Error("图片URL为空"),index:N,retries:T};return R[N]=b,B++,g&&g(B,h,b),u&&u(b),b}if(s&&Array.isArray(s)&&s.length>0){const{loadImageProgressiveWithCache:C}=await Promise.resolve().then(()=>At);return C(F,{stages:s,timeout:a,enableCache:c,urlTransformer:l,onStageError:f,onStageComplete:(b,L,Z)=>{j&&j({url:F,index:N,stageIndex:b,stageUrl:L,stage:Z,currentStage:b+1,totalStages:s.length},b)},onComplete:b=>{},onError:(b,L)=>{}}).then(b=>{const L={url:b.url,success:b.success,error:b.error,index:N,retries:T,stages:b.stages,fromCache:b.fromCache||!1};return R[N]=L,B++,g&&g(B,h,L),u&&u(L),L})}return new Promise(C=>{const b=new Image;let L=!1,Z=null;const te=()=>{Z&&(clearTimeout(Z),Z=null),b.onload=null,b.onerror=null,b.src=""},H=(q,$=null)=>{if(L)return null;L=!0,te();const G={url:F,success:q,error:$,index:N,retries:T};return R[N]=G,B++,g&&g(B,h,G),u&&u(G),G};Z=setTimeout(()=>{const q=new Error(`图片加载超时 (${a}ms)`),$=H(!1,q);w&&T<p?setTimeout(()=>{d(v,T+1).then(C)},1e3*(T+1)):C($)},a),b.onload=()=>{const q=H(!0,null);q&&C(q)},b.onerror=q=>{const $=new Error("图片加载失败");$.originalEvent=q;const G=H(!1,$);w&&T<p?setTimeout(()=>{d(v,T+1).then(C)},1e3*(T+1)):C(G)};try{b.crossOrigin="anonymous",b.src=F}catch(q){const $=H(!1,q);$&&C($)}})},S=[...y],P=new Set,z=[];return await(async()=>{for(;S.length>0||P.size>0;){for(;S.length>0&&P.size<n;){const v=S.shift(),T=d(v).then(F=>(P.delete(T),F)).catch(F=>{P.delete(T);const N={url:v.url,success:!1,error:F instanceof Error?F:new Error(String(F)),index:v.index,retries:0};return R[v.index]=N,B++,g&&g(B,h,N),u&&u(N),N});P.add(T),z.push(T)}P.size>0&&await Promise.race(Array.from(P))}})(),await Promise.all(z),R}async function vt(t,o={}){return Qe(t,{priority:!1,...o})}function Xe(t,o={}){if(!t)return t;const{width:n=20,height:a=null,quality:r=20,blur:s=10}=o;return pe(t,{width:n,height:a,quality:r,format:"jpg"})}async function et(t,o={}){var j;const{stages:n=[{width:20,quality:20,blur:10},{width:400,quality:50,blur:3},{width:null,quality:80,blur:0}],timeout:a=3e4,urlTransformer:r=null,onStageComplete:s=null,onStageError:c=null,onComplete:l=null,onError:f=null}=o;if(!t){const w=new Error("图片URL为空");return f&&f(w,-1),{url:"",stages:[],success:!1,error:w}}const g=[];let u=t;try{for(let p=0;p<n.length;p++){const y=n[p];let R;r&&typeof r=="function"?R=r(t,y,p):p===n.length-1&&!y.width&&!y.height?R=t:R=pe(t,{width:y.width||null,height:y.height||null,quality:y.quality||80,format:y.format||null,autoFormat:y.autoFormat!==!1});let B;try{B=await new Promise((h,d)=>{const S=new Image;let P=null,z=!1;const D=()=>{P&&(clearTimeout(P),P=null),S.onload=null,S.onerror=null,S.src=""};P=setTimeout(()=>{if(!z){z=!0,D();const v=new Error(`阶段 ${p+1} 加载超时: ${R}`);d(v)}},a),S.onload=()=>{z||(z=!0,D(),h({url:R,stage:y,loaded:!0}))},S.onerror=v=>{if(!z){z=!0,D();let T=`阶段 ${p+1} 加载失败`;try{if(v.target&&v.target.src){const N=v.target.src;T=`阶段 ${p+1} 加载失败`}}catch{}const F=new Error(T);F.originalEvent=v,F.stageUrl=R,F.stageIndex=p,d(F)}};try{S.crossOrigin="anonymous",S.src=R}catch(v){z||(z=!0,D(),d(v))}}),g.push(B),u=R,s&&s(p,R,y)}catch(h){let d=null;if(c&&typeof c=="function")try{d=c(h,p,R,y)}catch{}if(d&&typeof d=="string")try{const P=await new Promise((z,D)=>{const v=new Image;let T=null,F=!1;const N=()=>{T&&(clearTimeout(T),T=null),v.onload=null,v.onerror=null,v.src=""};T=setTimeout(()=>{F||(F=!0,N(),D(new Error(`降级URL加载超时: ${d}`)))},a),v.onload=()=>{F||(F=!0,N(),z({url:d,stage:y,loaded:!0}))},v.onerror=()=>{F||(F=!0,N(),D(new Error(`降级URL加载失败: ${d}`)))};try{v.crossOrigin="anonymous",v.src=d}catch(C){F||(F=!0,N(),D(C))}});g.push(P),u=d,s&&s(p,d,y);break}catch{}const S=h.message.includes("404")||h.originalEvent&&h.originalEvent.type==="error";if((!S||process.env.NODE_ENV==="development")&&(S||console.warn(`⚠️ 阶段 ${p+1} 加载失败，跳过继续下一阶段:`,h.message)),g.push({url:R,stage:y,loaded:!1,error:h}),p===n.length-1&&g.length>0){for(let P=g.length-1;P>=0;P--)if(g[P].loaded){u=g[P].url;break}}if(s&&s(p,R,y),!(p<n.length-1)){if(!g.some(P=>P.loaded))throw new Error(`所有阶段加载失败，最后一个错误: ${h.message}`)}}p<n.length-1&&await new Promise(h=>setTimeout(h,100))}if(!g.some(p=>p.loaded)){const p=((j=g[g.length-1])==null?void 0:j.error)||new Error("所有阶段加载失败"),y=p.message.includes("404")||p.originalEvent&&p.originalEvent.type==="error";return(!y||process.env.NODE_ENV==="development")&&(y||console.error(`❌ 图片加载失败: ${t.substring(0,50)}...`,p.message)),f&&f(p,g.length-1),{url:u||t,stages:g,success:!1,error:p}}return l&&l(u),{url:u,stages:g,success:!0,error:null}}catch(w){const p=g.length,y=w.message&&w.message.includes("404");return(!y||process.env.NODE_ENV==="development")&&(y||console.error(`❌ 渐进式加载过程出错: ${t.substring(0,50)}...`,w.message||w)),f&&f(w,p),{url:u||t,stages:g,success:!1,error:w}}}async function bt(t,o={}){const{stages:n=[{width:20,quality:20,blur:10},{width:400,quality:50,blur:3},{width:null,quality:80,blur:0}],concurrency:a=5,timeout:r=3e4,onProgress:s=null,onItemStageComplete:c=null,onItemComplete:l=null}=o,f=t.map((h,d)=>typeof h=="string"?{url:h,index:d}:{url:h.url||h.src||"",index:h.index!==void 0?h.index:d}),g=new Array(f.length);let u=0;const j=f.length,w=async h=>{const{url:d,index:S}=h,P=await et(d,{stages:n,timeout:r,onStageComplete:(z,D,v)=>{c&&c({url:d,index:S,stageIndex:z,stageUrl:D,stage:v,currentStage:z+1,totalStages:n.length},z)},onComplete:z=>{},onError:(z,D)=>{}});return g[S]=P,u++,s&&s(u,j,P),l&&l(P),P},p=[...f],y=new Set,R=[];return await(async()=>{for(;p.length>0||y.size>0;){for(;p.length>0&&y.size<a;){const h=p.shift(),d=w(h).then(S=>(y.delete(d),S)).catch(S=>{y.delete(d);const P={url:h.url,stages:[],success:!1,error:S instanceof Error?S:new Error(String(S))};return g[h.index]=P,u++,s&&s(u,j,P),l&&l(P),P});y.add(d),R.push(d)}y.size>0&&await Promise.race(Array.from(y))}})(),await Promise.all(R),g}async function tt(t,o={}){const{maxWidth:n=null,maxHeight:a=null,quality:r=.8,compressionLevel:s=.5,blur:c=0,smooth:l=!0,format:f=null}=o;if(typeof window>"u"||typeof document>"u")throw new Error("浏览器端压缩功能仅在浏览器环境中可用");return new Promise((g,u)=>{const j=new Image;if(j.crossOrigin="anonymous",j.onload=()=>{try{let{width:w,height:p}=j,y=w,R=p,B=!1;if(n||a){const C=Math.min(n?n/w:1,a?a/p:1);C<1&&(y=Math.round(w*C),R=Math.round(p*C),B=!0)}let h=y,d=R;if(s>0){const C=1-s*.75;h=Math.round(y*C),d=Math.round(R*C)}const S=h!==w||d!==p;if(!(S||s>0||c>0)&&typeof t=="string"){g(t);return}const z=document.createElement("canvas");z.width=h,z.height=d;const D=z.getContext("2d");if(S?(D.imageSmoothingEnabled=l,D.imageSmoothingQuality=l?"high":"low"):D.imageSmoothingEnabled=!1,D.drawImage(j,0,0,h,d),c>0){const C=document.createElement("canvas"),b=C.getContext("2d");if(C.width=h,C.height=d,b.drawImage(j,0,0,h,d),b.filter!==void 0)try{b.filter=`blur(${c}px)`,b.drawImage(C,0,0),b.filter="none",D.clearRect(0,0,z.width,z.height),D.drawImage(C,0,0)}catch{St(D,C,h,d,c)}else St(D,C,h,d,c)}let v=f;if(!v)if(s>0||c>0||S)v=ze().includes("webp")?"webp":"jpeg";else{const b=Je(t);b&&["jpg","jpeg","png"].includes(b)?v=b==="jpeg"?"jpeg":b:v=ze().includes("webp")?"webp":"jpeg"}let T=r;s>0?(T=r*(1-s*.7),T=Math.max(.1,Math.min(1,T))):!S&&c===0?T=Math.max(r,.98):S&&(T=Math.max(r,.92));const F=v==="webp"?"image/webp":v==="png"?"image/png":"image/jpeg",N=z.toDataURL(F,T);g(N)}catch(w){u(new Error("图片压缩失败: "+w.message))}},j.onerror=()=>{u(new Error("图片加载失败"))},typeof t=="string")j.src=t;else if(t instanceof File||t instanceof Blob){const w=new FileReader;w.onload=p=>{j.src=p.target.result},w.onerror=()=>u(new Error("文件读取失败")),w.readAsDataURL(t)}else u(new Error("不支持的图片源类型"))})}function St(t,o,n,a,r){const s=document.createElement("canvas"),c=s.getContext("2d"),l=Math.max(.3,1-r/10),f=Math.round(n*l),g=Math.round(a*l);s.width=f,s.height=g,c.drawImage(o,0,0,n,a,0,0,f,g),t.clearRect(0,0,n,a),t.drawImage(s,0,0,f,g,0,0,n,a)}function rt(t){const o=t.split(","),n=o[0].match(/:(.*?);/)[1],a=atob(o[1]);let r=a.length;const s=new Uint8Array(r);for(;r--;)s[r]=a.charCodeAt(r);return new Blob([s],{type:n})}async function Ae(t){if(!t)return null;try{if(t.startsWith("blob:"))return(await(await fetch(t)).blob()).size;if(t.startsWith("data:")){const a=t.split(",")[1];if(a){const r=atob(a);return new Blob([r]).size}return null}try{const r=(await fetch(t,{method:"HEAD"})).headers.get("Content-Length");if(r)return parseInt(r,10)}catch{}return(await(await fetch(t)).blob()).size}catch{return null}}function Te(t){if(t==null)return"未知";if(t===0)return"0 B";const o=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(o));return parseFloat((t/Math.pow(o,a)).toFixed(2))+" "+n[a]}function ve(t){if(!t)return null;for(const[o,n]of Object.entries(ht))if(n.test(t))return o;return null}async function nt(t,o){const[n,a]=await Promise.all([Ae(t),Ae(o)]);let r=null,s=null,c=!1,l=null;return n!==null&&a!==null&&(r=n-a,s=parseFloat((r/n*100).toFixed(2)),c=r>1024||s>1,!c&&r===0?ve(t)?l="⚠️ 优化参数可能无效，图片大小未发生变化。请检查CDN配置是否正确。":l="⚠️ 该图片URL不是支持的CDN，通用查询参数可能无效。支持的CDN：阿里云OSS、腾讯云COS、七牛云、又拍云、AWS CloudFront。":!c&&r>0&&s<=1&&(l=`⚠️ 优化效果不明显（仅节省 ${s}%），可能优化参数未生效。`)),{originalUrl:t,optimizedUrl:o,originalSize:n,optimizedSize:a,savedSize:r,savedPercentage:s,isOptimizationEffective:c,warningMessage:l,originalSizeFormatted:Te(n),optimizedSizeFormatted:Te(a),savedSizeFormatted:Te(r),cdn:ve(t)}}const Lt=Object.freeze(Object.defineProperty({__proto__:null,compareImageSizes:nt,compressImageInBrowser:tt,dataURLToBlob:rt,detectCDN:ve,detectImageFormat:Je,detectSupportedFormats:ze,formatFileSize:Te,generateBlurPlaceholderUrl:Xe,generateResponsiveImage:pt,generateSizes:Be,generateSrcset:Ze,getBestFormat:Me,getImageSize:Ae,getOptimizedCoverUrl:wt,loadImageProgressive:et,loadImagesBatch:vt,loadImagesProgressiveBatch:bt,loadImagesProgressively:Qe,optimizeImageUrl:pe,preloadImage:Ge,preloadImages:yt},Symbol.toStringTag,{value:"Module"}));var at={exports:{}},Oe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Et;function kt(){if(Et)return Oe;Et=1;var t=_,o=Symbol.for("react.element"),n=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,r=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function c(l,f,g){var u,j={},w=null,p=null;g!==void 0&&(w=""+g),f.key!==void 0&&(w=""+f.key),f.ref!==void 0&&(p=f.ref);for(u in f)a.call(f,u)&&!s.hasOwnProperty(u)&&(j[u]=f[u]);if(l&&l.defaultProps)for(u in f=l.defaultProps,f)j[u]===void 0&&(j[u]=f[u]);return{$$typeof:o,type:l,key:w,ref:p,props:j,_owner:r.current}}return Oe.Fragment=n,Oe.jsx=c,Oe.jsxs=c,Oe}var Fe={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rt;function Dt(){return Rt||(Rt=1,process.env.NODE_ENV!=="production"&&function(){var t=_,o=Symbol.for("react.element"),n=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),c=Symbol.for("react.provider"),l=Symbol.for("react.context"),f=Symbol.for("react.forward_ref"),g=Symbol.for("react.suspense"),u=Symbol.for("react.suspense_list"),j=Symbol.for("react.memo"),w=Symbol.for("react.lazy"),p=Symbol.for("react.offscreen"),y=Symbol.iterator,R="@@iterator";function B(e){if(e===null||typeof e!="object")return null;var i=y&&e[y]||e[R];return typeof i=="function"?i:null}var h=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function d(e){{for(var i=arguments.length,m=new Array(i>1?i-1:0),E=1;E<i;E++)m[E-1]=arguments[E];S("error",e,m)}}function S(e,i,m){{var E=h.ReactDebugCurrentFrame,A=E.getStackAddendum();A!==""&&(i+="%s",m=m.concat([A]));var V=m.map(function(k){return String(k)});V.unshift("Warning: "+i),Function.prototype.apply.call(console[e],console,V)}}var P=!1,z=!1,D=!1,v=!1,T=!1,F;F=Symbol.for("react.module.reference");function N(e){return!!(typeof e=="string"||typeof e=="function"||e===a||e===s||T||e===r||e===g||e===u||v||e===p||P||z||D||typeof e=="object"&&e!==null&&(e.$$typeof===w||e.$$typeof===j||e.$$typeof===c||e.$$typeof===l||e.$$typeof===f||e.$$typeof===F||e.getModuleId!==void 0))}function C(e,i,m){var E=e.displayName;if(E)return E;var A=i.displayName||i.name||"";return A!==""?m+"("+A+")":m}function b(e){return e.displayName||"Context"}function L(e){if(e==null)return null;if(typeof e.tag=="number"&&d("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case a:return"Fragment";case n:return"Portal";case s:return"Profiler";case r:return"StrictMode";case g:return"Suspense";case u:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case l:var i=e;return b(i)+".Consumer";case c:var m=e;return b(m._context)+".Provider";case f:return C(e,e.render,"ForwardRef");case j:var E=e.displayName||null;return E!==null?E:L(e.type)||"Memo";case w:{var A=e,V=A._payload,k=A._init;try{return L(k(V))}catch{return null}}}return null}var Z=Object.assign,te=0,H,q,$,G,ee,ce,be;function we(){}we.__reactDisabledLog=!0;function Ye(){{if(te===0){H=console.log,q=console.info,$=console.warn,G=console.error,ee=console.group,ce=console.groupCollapsed,be=console.groupEnd;var e={configurable:!0,enumerable:!0,value:we,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}te++}}function Se(){{if(te--,te===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:Z({},e,{value:H}),info:Z({},e,{value:q}),warn:Z({},e,{value:$}),error:Z({},e,{value:G}),group:Z({},e,{value:ee}),groupCollapsed:Z({},e,{value:ce}),groupEnd:Z({},e,{value:be})})}te<0&&d("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var ye=h.ReactCurrentDispatcher,oe;function Ee(e,i,m){{if(oe===void 0)try{throw Error()}catch(A){var E=A.stack.trim().match(/\n( *(at )?)/);oe=E&&E[1]||""}return`
`+oe+e}}var ue=!1,he;{var Re=typeof WeakMap=="function"?WeakMap:Map;he=new Re}function me(e,i){if(!e||ue)return"";{var m=he.get(e);if(m!==void 0)return m}var E;ue=!0;var A=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var V;V=ye.current,ye.current=null,Ye();try{if(i){var k=function(){throw Error()};if(Object.defineProperty(k.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(k,[])}catch(ae){E=ae}Reflect.construct(e,[],k)}else{try{k.call()}catch(ae){E=ae}e.call(k.prototype)}}else{try{throw Error()}catch(ae){E=ae}e()}}catch(ae){if(ae&&E&&typeof ae.stack=="string"){for(var U=ae.stack.split(`
`),ne=E.stack.split(`
`),K=U.length-1,J=ne.length-1;K>=1&&J>=0&&U[K]!==ne[J];)J--;for(;K>=1&&J>=0;K--,J--)if(U[K]!==ne[J]){if(K!==1||J!==1)do if(K--,J--,J<0||U[K]!==ne[J]){var le=`
`+U[K].replace(" at new "," at ");return e.displayName&&le.includes("<anonymous>")&&(le=le.replace("<anonymous>",e.displayName)),typeof e=="function"&&he.set(e,le),le}while(K>=1&&J>=0);break}}}finally{ue=!1,ye.current=V,Se(),Error.prepareStackTrace=A}var je=e?e.displayName||e.name:"",xe=je?Ee(je):"";return typeof e=="function"&&he.set(e,xe),xe}function Ce(e,i,m){return me(e,!1)}function re(e){var i=e.prototype;return!!(i&&i.isReactComponent)}function fe(e,i,m){if(e==null)return"";if(typeof e=="function")return me(e,re(e));if(typeof e=="string")return Ee(e);switch(e){case g:return Ee("Suspense");case u:return Ee("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case f:return Ce(e.render);case j:return fe(e.type,i,m);case w:{var E=e,A=E._payload,V=E._init;try{return fe(V(A),i,m)}catch{}}}return""}var se=Object.prototype.hasOwnProperty,Le={},Pe=h.ReactDebugCurrentFrame;function ge(e){if(e){var i=e._owner,m=fe(e.type,e._source,i?i.type:null);Pe.setExtraStackFrame(m)}else Pe.setExtraStackFrame(null)}function Ke(e,i,m,E,A){{var V=Function.call.bind(se);for(var k in e)if(V(e,k)){var U=void 0;try{if(typeof e[k]!="function"){var ne=Error((E||"React class")+": "+m+" type `"+k+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[k]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw ne.name="Invariant Violation",ne}U=e[k](i,k,E,m,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(K){U=K}U&&!(U instanceof Error)&&(ge(A),d("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",E||"React class",m,k,typeof U),ge(null)),U instanceof Error&&!(U.message in Le)&&(Le[U.message]=!0,ge(A),d("Failed %s type: %s",m,U.message),ge(null))}}}var lt=Array.isArray;function ke(e){return lt(e)}function ct(e){{var i=typeof Symbol=="function"&&Symbol.toStringTag,m=i&&e[Symbol.toStringTag]||e.constructor.name||"Object";return m}}function de(e){try{return ie(e),!1}catch{return!0}}function ie(e){return""+e}function $e(e){if(de(e))return d("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",ct(e)),ie(e)}var M=h.ReactCurrentOwner,x={key:!0,ref:!0,__self:!0,__source:!0},W,I;function Q(e){if(se.call(e,"ref")){var i=Object.getOwnPropertyDescriptor(e,"ref").get;if(i&&i.isReactWarning)return!1}return e.ref!==void 0}function De(e){if(se.call(e,"key")){var i=Object.getOwnPropertyDescriptor(e,"key").get;if(i&&i.isReactWarning)return!1}return e.key!==void 0}function Ie(e,i){typeof e.ref=="string"&&M.current}function ut(e,i){{var m=function(){W||(W=!0,d("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",i))};m.isReactWarning=!0,Object.defineProperty(e,"key",{get:m,configurable:!0})}}function Wt(e,i){{var m=function(){I||(I=!0,d("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",i))};m.isReactWarning=!0,Object.defineProperty(e,"ref",{get:m,configurable:!0})}}var Vt=function(e,i,m,E,A,V,k){var U={$$typeof:o,type:e,key:i,ref:m,props:k,_owner:V};return U._store={},Object.defineProperty(U._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(U,"_self",{configurable:!1,enumerable:!1,writable:!1,value:E}),Object.defineProperty(U,"_source",{configurable:!1,enumerable:!1,writable:!1,value:A}),Object.freeze&&(Object.freeze(U.props),Object.freeze(U)),U};function qt(e,i,m,E,A){{var V,k={},U=null,ne=null;m!==void 0&&($e(m),U=""+m),De(i)&&($e(i.key),U=""+i.key),Q(i)&&(ne=i.ref,Ie(i,A));for(V in i)se.call(i,V)&&!x.hasOwnProperty(V)&&(k[V]=i[V]);if(e&&e.defaultProps){var K=e.defaultProps;for(V in K)k[V]===void 0&&(k[V]=K[V])}if(U||ne){var J=typeof e=="function"?e.displayName||e.name||"Unknown":e;U&&ut(k,J),ne&&Wt(k,J)}return Vt(e,U,ne,A,E,M.current,k)}}var ft=h.ReactCurrentOwner,_t=h.ReactDebugCurrentFrame;function _e(e){if(e){var i=e._owner,m=fe(e.type,e._source,i?i.type:null);_t.setExtraStackFrame(m)}else _t.setExtraStackFrame(null)}var dt;dt=!1;function mt(e){return typeof e=="object"&&e!==null&&e.$$typeof===o}function jt(){{if(ft.current){var e=L(ft.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function Ht(e){return""}var zt={};function Yt(e){{var i=jt();if(!i){var m=typeof e=="string"?e:e.displayName||e.name;m&&(i=`

Check the top-level render call using <`+m+">.")}return i}}function Tt(e,i){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var m=Yt(i);if(zt[m])return;zt[m]=!0;var E="";e&&e._owner&&e._owner!==ft.current&&(E=" It was passed a child from "+L(e._owner.type)+"."),_e(e),d('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',m,E),_e(null)}}function Ot(e,i){{if(typeof e!="object")return;if(ke(e))for(var m=0;m<e.length;m++){var E=e[m];mt(E)&&Tt(E,i)}else if(mt(e))e._store&&(e._store.validated=!0);else if(e){var A=B(e);if(typeof A=="function"&&A!==e.entries)for(var V=A.call(e),k;!(k=V.next()).done;)mt(k.value)&&Tt(k.value,i)}}}function Kt(e){{var i=e.type;if(i==null||typeof i=="string")return;var m;if(typeof i=="function")m=i.propTypes;else if(typeof i=="object"&&(i.$$typeof===f||i.$$typeof===j))m=i.propTypes;else return;if(m){var E=L(i);Ke(m,e.props,"prop",E,e)}else if(i.PropTypes!==void 0&&!dt){dt=!0;var A=L(i);d("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",A||"Unknown")}typeof i.getDefaultProps=="function"&&!i.getDefaultProps.isReactClassApproved&&d("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function $t(e){{for(var i=Object.keys(e.props),m=0;m<i.length;m++){var E=i[m];if(E!=="children"&&E!=="key"){_e(e),d("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",E),_e(null);break}}e.ref!==null&&(_e(e),d("Invalid attribute `ref` supplied to `React.Fragment`."),_e(null))}}var Ft={};function Ut(e,i,m,E,A,V){{var k=N(e);if(!k){var U="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(U+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var ne=Ht();ne?U+=ne:U+=jt();var K;e===null?K="null":ke(e)?K="array":e!==void 0&&e.$$typeof===o?(K="<"+(L(e.type)||"Unknown")+" />",U=" Did you accidentally export a JSX literal instead of a component?"):K=typeof e,d("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",K,U)}var J=qt(e,i,m,A,V);if(J==null)return J;if(k){var le=i.children;if(le!==void 0)if(E)if(ke(le)){for(var je=0;je<le.length;je++)Ot(le[je],e);Object.freeze&&Object.freeze(le)}else d("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else Ot(le,e)}if(se.call(i,"key")){var xe=L(e),ae=Object.keys(i).filter(function(er){return er!=="key"}),gt=ae.length>0?"{key: someKey, "+ae.join(": ..., ")+": ...}":"{key: someKey}";if(!Ft[xe+gt]){var Xt=ae.length>0?"{"+ae.join(": ..., ")+": ...}":"{}";d(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,gt,xe,Xt,xe),Ft[xe+gt]=!0}}return e===a?$t(J):Kt(J),J}}function Jt(e,i,m){return Ut(e,i,m,!0)}function Zt(e,i,m){return Ut(e,i,m,!1)}var Gt=Zt,Qt=Jt;Fe.Fragment=a,Fe.jsx=Gt,Fe.jsxs=Qt}()),Fe}process.env.NODE_ENV==="production"?at.exports=kt():at.exports=Dt();var Y=at.exports;const Mt="ImageOptimizeCache",Bt=1,X="imageCache",Ct=30*24*60*60*1e3;let Ne=null;const Ue=()=>new Promise((t,o)=>{if(Ne){t(Ne);return}const n=indexedDB.open(Mt,Bt);n.onerror=()=>{console.error("❌ IndexedDB 打开失败:",n.error),o(n.error)},n.onsuccess=()=>{Ne=n.result,t(Ne)},n.onupgradeneeded=a=>{const r=a.target.result;r.objectStoreNames.contains(X)||r.createObjectStore(X,{keyPath:"url"}).createIndex("timestamp","timestamp",{unique:!1})}}),We=async t=>{try{const o=await Ue();if(!o.objectStoreNames.contains(X))return null;const r=o.transaction([X],"readonly").objectStore(X).get(t);return new Promise((s,c)=>{r.onsuccess=()=>{const l=r.result;if(l&&Date.now()-l.timestamp<Ct){const f=new Uint8Array(l.data);s({data:f,timestamp:l.timestamp,mimeType:l.mimeType||"image/jpeg"})}else s(null)},r.onerror=()=>c(r.error)})}catch(o){return console.error("❌ 从 IndexedDB 读取图片缓存失败:",o),null}},Ve=async(t,o,n="image/jpeg")=>{try{const a=await Ue();if(!a.objectStoreNames.contains(X))return;const s=a.transaction([X],"readwrite").objectStore(X),c={url:t,data:o.buffer,timestamp:Date.now(),mimeType:n},l=s.put(c);return new Promise((f,g)=>{l.onsuccess=()=>{f()},l.onerror=()=>g(l.error)})}catch(a){console.error("❌ 保存图片缓存到 IndexedDB 失败:",a)}},qe=async t=>{try{const o=await Ue();if(!o.objectStoreNames.contains(X))return;const a=o.transaction([X],"readwrite").objectStore(X);if(t){const r=a.delete(t);return new Promise((s,c)=>{r.onsuccess=()=>{s()},r.onerror=()=>c(r.error)})}else{const r=a.clear();return new Promise((s,c)=>{r.onsuccess=()=>{s()},r.onerror=()=>c(r.error)})}}catch(o){console.error("❌ 删除图片缓存失败:",o)}},ot=async()=>{try{const t=await Ue();if(!t.objectStoreNames.contains(X))return;const a=t.transaction([X],"readwrite").objectStore(X).index("timestamp"),r=Date.now(),s=IDBKeyRange.upperBound(r-Ct),c=a.openCursor(s);return new Promise((l,f)=>{c.onsuccess=g=>{const u=g.target.result;u?(u.delete(),u.continue()):l()},c.onerror=()=>f(c.error)})}catch(t){console.error("❌ 清理过期图片缓存失败:",t)}},Pt=async()=>{try{const t=await Ue();if(!t.objectStoreNames.contains(X))return{count:0,totalSize:0,totalSizeMB:0};const a=t.transaction([X],"readonly").objectStore(X).getAll();return new Promise((r,s)=>{a.onsuccess=()=>{const c=a.result,l=c.reduce((f,g)=>f+(g.data?g.data.byteLength:0),0);r({count:c.length,totalSize:l,totalSizeMB:Math.round(l/1024/1024*100)/100})},a.onerror=()=>s(a.error)})}catch(t){return console.error("❌ 获取图片缓存统计失败:",t),{count:0,totalSize:0,totalSizeMB:0}}},He=(t,o)=>{try{const n=new Blob([t],{type:o});return URL.createObjectURL(n)}catch(n){return console.error("❌ 创建 Blob URL 失败:",n),null}},st=async t=>{try{await ot();const o=await We(t);if(o){const l=He(o.data,o.mimeType);if(l)return l}const n=await fetch(t);if(!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const a=await n.arrayBuffer(),r=new Uint8Array(a),s=n.headers.get("Content-Type")||"image/jpeg";return await Ve(t,r,s),He(r,s)}catch(o){throw console.error("❌ 加载图片失败:",o),await qe(t),o}},xt=async t=>{await qe(t)},it=async(t,o={})=>{const{loadImageProgressive:n,optimizeImageUrl:a}=await Promise.resolve().then(()=>Lt),{stages:r=[{width:20,quality:20,blur:10},{width:400,quality:50,blur:3},{width:null,quality:80,blur:0}],timeout:s=3e4,enableCache:c=!0,urlTransformer:l=null,onStageComplete:f=null,onComplete:g=null,onError:u=null,onStageError:j=null}=o;if(!t){const w=new Error("图片URL为空");return u&&u(w,-1),{url:"",stages:[],success:!1,error:w,fromCache:!1}}try{if(!c)return{...await n(t,{stages:r,timeout:s,urlTransformer:l,onStageError:j,onStageComplete:f,onComplete:g,onError:u}),fromCache:!1};const w=r[r.length-1];let p=t;l&&typeof l=="function"?p=l(t,w,r.length-1):w&&(w.width||w.height)&&(p=a(t,{width:w.width||null,height:w.height||null,quality:w.quality||80,format:w.format||null,autoFormat:w.autoFormat!==!1}));const y=await We(p);if(y){const h=He(y.data,y.mimeType);if(h)return g&&g(h),f&&r.forEach((d,S)=>{S===r.length-1&&f(S,h,d)}),{url:h,stages:r.map((d,S)=>({url:S===r.length-1?h:"",stage:d,loaded:S===r.length-1})),success:!0,error:null,fromCache:!0}}const R=p;return{...await n(t,{stages:r,timeout:s,urlTransformer:l,onStageError:j,onStageComplete:f,onComplete:async h=>{if(h.startsWith("blob:"))console.log(`[渐进式加载缓存] 图片来自缓存，跳过保存: ${h.substring(0,30)}...`);else try{const d=await fetch(h);if(d.ok){const S=await d.arrayBuffer(),P=new Uint8Array(S),z=d.headers.get("Content-Type")||"image/jpeg";await Ve(R,P,z),console.log(`[渐进式加载缓存] 已保存到缓存: ${R.substring(0,50)}...`)}else console.warn(`[渐进式加载缓存] 响应状态码错误: ${d.status} - ${h.substring(0,50)}...`)}catch(d){console.warn("[渐进式加载缓存] 保存缓存失败:",d.message||d,h.substring(0,50))}g&&g(h)},onError:u}),fromCache:!1}}catch(w){const p=w.message&&w.message.includes("404");return(!p||process.env.NODE_ENV==="development")&&(p||console.error("❌ 渐进式加载图片失败:",w.message||w)),u&&u(w,-1),{url:"",stages:[],success:!1,error:w,fromCache:!1}}},At=Object.freeze(Object.defineProperty({__proto__:null,cleanExpiredImageCache:ot,clearImageCache:xt,createBlobUrlFromCache:He,deleteImageCache:qe,getImageCache:We,getImageCacheStats:Pt,loadImageProgressiveWithCache:it,loadImageWithCache:st,saveImageCache:Ve},Symbol.toStringTag,{value:"Module"}));function It({src:t="",alt:o="",width:n="100%",height:a="auto",className:r="",imageClassName:s="",dataId:c=null,imageStyle:l={},immediate:f=!1,rootMargin:g="50px",optimize:u={width:240,height:320,quality:30},enableBrowserCompression:j=!0,showPlaceholderIcon:w=!1,showErrorMessage:p=!1,errorSrc:y=null,progressive:R=!1,progressiveStages:B=[{width:20,quality:20,blur:10},{width:400,quality:50,blur:3},{width:null,quality:80,blur:0}],progressiveTransitionDuration:h=300,progressiveTimeout:d=3e4,progressiveEnableCache:S=!0,onLoad:P=null,onOptimization:z=null,onError:D=null,onClick:v=null,onProgressiveStageComplete:T=null}){const F=_.useRef(null),N=_.useRef(null),C=_.useRef(null),b=_.useRef(null),[L,Z]=_.useState(!1),[te,H]=_.useState(!1),[q,$]=_.useState(!1),[G,ee]=_.useState(f),[ce,be]=_.useState(""),[we,Ye]=_.useState(null),[Se,ye]=_.useState(!1),[oe,Ee]=_.useState(null),ue=_.useRef(null),[he,Re]=_.useState(-1),[me,Ce]=_.useState(""),re=_.useRef(null),fe=_.useRef(-1),se=_.useRef(!1),Le=_.useRef(null),Pe=M=>{if(!M)return"";try{if(u&&Object.keys(u).length>0){const x=pe(M,u);if(x&&x.trim())return x}return M}catch(x){return console.warn("图片URL优化失败，使用原始URL:",x),M}},ge=_.useMemo(()=>t?R&&me?me:we||oe||(L&&ce?ce:Pe(t)):"",[t,L,ce,u,we,oe,R,me]),Ke=()=>{if(f||typeof window>"u"||!window.IntersectionObserver){ee(!0);return}C.current&&(C.current.disconnect(),C.current=null),C.current=new IntersectionObserver(M=>{M.forEach(x=>{x.isIntersecting&&(ee(!0),C.current&&x.target&&C.current.unobserve(x.target))})},{rootMargin:g,threshold:.01}),setTimeout(()=>{N.current&&C.current&&C.current.observe(N.current)},0)},lt=async M=>{if(R){const I=fe.current;if(I>=0&&I<B.length)return}if(L)return;const x=M.target.src;if(Z(!0),H(!1),$(!1),be(x),!x.startsWith("blob:")&&!x.startsWith("data:"))try{const I=Pe(t),Q=await fetch(I);if(Q.ok){const De=await Q.arrayBuffer(),Ie=new Uint8Array(De),ut=Q.headers.get("Content-Type")||"image/jpeg";await saveImageCache(I,Ie,ut)}}catch(I){console.warn("保存图片缓存失败:",I)}let W=null;if(t&&x!==t)try{const I=await nt(t,x);I.originalSize!==null&&I.optimizedSize!==null?(W={originalUrl:I.originalUrl,originalSize:I.originalSize,originalSizeFormatted:I.originalSizeFormatted,optimizedUrl:I.optimizedUrl,optimizedSize:I.optimizedSize,optimizedSizeFormatted:I.optimizedSizeFormatted,savedSize:I.savedSize,savedSizeFormatted:I.savedSizeFormatted,savedPercentage:I.savedPercentage,cdn:I.cdn,isOptimizationEffective:I.isOptimizationEffective,warningMessage:I.warningMessage},b.current=W,z&&z(W),I.cdn,I.warningMessage&&console.warn(I.warningMessage),I.isOptimizationEffective):(W={originalUrl:t,optimizedUrl:x,originalSize:null,originalSizeFormatted:null,optimizedSize:null,optimizedSizeFormatted:null,savedSize:null,savedSizeFormatted:null,savedPercentage:null,cdn:ve(t),isOptimizationEffective:null,warningMessage:"⚠️ 无法获取图片大小（可能由于CORS限制）"},b.current=W,z&&z(W))}catch(I){console.warn("获取图片大小对比失败:",I),W={originalUrl:t,optimizedUrl:x,originalSize:null,originalSizeFormatted:null,optimizedSize:null,optimizedSizeFormatted:null,savedSize:null,savedSizeFormatted:null,savedPercentage:null,cdn:ve(t),isOptimizationEffective:null,warningMessage:`获取图片大小对比失败: ${I.message}`},b.current=W,z&&z(W)}P&&P(M,W)},ke=M=>{if(L)return;const x=M.target.src,W=Pe(t);if(y&&(x===y||x.includes("videoCover.png"))){$(!0),H(!1),D&&D(M);return}if(x===W&&W!==t){console.log("优化URL加载失败，尝试原始URL:",t),M.target.src=t;return}if(x===t||W===t){if(y&&x!==y){console.log("原始URL加载失败，尝试加载错误图片:",y),M.target.src=y;return}console.log("图片加载失败，显示错误占位符"),$(!0),H(!1),D&&D(M)}},ct=M=>{var x;if(v){const W={src:t,currentSrc:((x=M.target)==null?void 0:x.src)||ge,optimizedSrc:ge,alt:o,dataId:c,isLoaded:L,isLoading:te,hasError:q,isCompressing:Se,optimizationInfo:b.current,imageElement:M.target};v(M,W)}};_.useEffect(()=>{Le.current=B},[B]);const de=_.useRef(!1),ie=_.useRef(null);_.useEffect(()=>{if(!R){de.current=!1,ie.current=null;return}if(ie.current!==t&&(de.current=!1,ie.current=t),de.current||!t||!G)return;de.current=!0,se.current=!0,H(!0);let M=!1;const x=t,W=Le.current||B;return re.current=()=>{M=!0,se.current=!1,de.current=!1},it(x,{stages:W,timeout:d,enableCache:S,onStageComplete:(I,Q,De)=>{if(M||ie.current!==x)return;const Ie=I+1;requestAnimationFrame(()=>{!M&&ie.current===x&&(Re(Ie),fe.current=Ie,Ce(Q),T&&T(I,Q,De))})},onComplete:I=>{M||ie.current!==x||requestAnimationFrame(()=>{if(!M&&ie.current===x){H(!1),Ce(I),se.current=!1;const Q=W.length;Re(Q),fe.current=Q}})},onError:(I,Q)=>{M||ie.current!==x||(console.warn(`[渐进式加载 ${x.substring(0,20)}...] 阶段 ${Q+1} 失败:`,I.message||I),H(!1),se.current=!1,de.current=!1,Ce(""),Re(-1),fe.current=-1,H(!0))}}).catch(I=>{!M&&ie.current===x&&(console.error(`[渐进式加载 ${x.substring(0,20)}...] 加载过程出错:`,I),H(!1),se.current=!1,de.current=!1,Ce(""),Re(-1),fe.current=-1)}),()=>{M=!0,se.current=!1,de.current=!1}},[R,G,t,d,S]),_.useEffect(()=>{R||!R&&G&&!L&&!q&&!te&&!Se&&!oe&&!me&&t&&(async()=>{try{const x=Pe(t),W=await st(x);if(W)return Ee(W),ue.current=W,!0}catch{}return!1})().then(x=>{if(!x){const W=ve(t);j&&!W&&u&&Object.keys(u).length>0&&typeof window<"u"&&!we?(ye(!0),tt(t,{maxWidth:u.width||null,maxHeight:u.height||null,quality:u.quality?u.quality/100:.8,compressionLevel:u.compressionLevel!==void 0?u.compressionLevel:0,blur:u.blur!==void 0?u.blur:0,smooth:u.smooth!==void 0?u.smooth:!0,format:u.format||null}).then(Q=>{Ye(Q),ye(!1),rt(Q)}).catch(Q=>{console.warn("浏览器端压缩失败，使用原始URL:",Q),ye(!1)})):H(!0)}})},[G,L,q,te,Se,t,u,we,oe,j]),_.useEffect(()=>{ue.current&&(URL.revokeObjectURL(ue.current),ue.current=null),re.current&&(re.current(),re.current=null),Z(!1),$(!1),H(!1),be(""),Ye(null),ye(!1),Ee(null),re.current&&(re.current(),re.current=null),re.current&&(re.current(),re.current=null),Ce(""),Re(-1),fe.current=-1,se.current=!1,de.current=!1,ie.current=null,b.current=null,f?ee(!0):Ke()},[t]),_.useEffect(()=>(f?ee(!0):Ke(),()=>{C.current&&(C.current.disconnect(),C.current=null),ue.current&&(URL.revokeObjectURL(ue.current),ue.current=null),re.current&&(re.current(),re.current=null)}),[]);const $e={width:typeof n=="number"?`${n}px`:n,height:typeof a=="number"?`${a}px`:a};return Y.jsxs("div",{ref:N,className:`image-optimize-container ${r}`.trim(),style:$e,children:[!L&&!q&&!te&&!oe&&!me&&Y.jsx("div",{className:"image-optimize-placeholder",children:w&&Y.jsx("svg",{className:"image-optimize-placeholder-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Y.jsx("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19ZM13.96 12.29L11.21 15.83L9.25 13.47L6.5 17H17.5L13.96 12.29Z",fill:"currentColor"})})}),(te||Se)&&!q&&!oe&&!me&&Y.jsxs("div",{className:"image-optimize-loading",children:[Y.jsx("svg",{className:"image-optimize-loading-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Y.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeDasharray:"62.83",strokeDashoffset:"31.42"})}),Se&&Y.jsx("span",{style:{marginTop:"8px",fontSize:"12px",color:"#666"},children:"正在压缩图片..."})]}),G&&ge&&Y.jsx("img",{ref:F,src:ge,alt:o,"data-id":c,className:`image-optimize-image ${s}`.trim(),style:{display:L||oe||me||!q&&ge?"block":"none",transition:R?`opacity ${h}ms ease-in-out, filter ${h}ms ease-in-out`:void 0,opacity:R&&he>=0||L||oe?1:0,filter:R?he===1?"blur(10px)":he===2?"blur(3px)":he>=3?"blur(0px)":"blur(10px)":void 0,...l},onLoad:lt,onError:ke,onClick:ct}),q&&Y.jsxs("div",{className:"image-optimize-error",children:[Y.jsx("svg",{className:"image-optimize-error-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Y.jsx("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19Z",fill:"currentColor"})}),p&&Y.jsx("span",{className:"image-optimize-error-text",children:"加载失败"})]})]})}function Nt({src:t="",alt:o="",width:n="100%",height:a="auto",className:r="",imageClassName:s="",imageStyle:c={},stages:l=[{width:20,quality:20},{width:400,quality:50},{width:null,quality:80}],transitionDuration:f=300,timeout:g=3e4,enableCache:u=!0,showPlaceholder:j=!0,onStageComplete:w=null,onComplete:p=null,onError:y=null,onLoad:R=null}){const[B,h]=_.useState(-1),[d,S]=_.useState(""),[P,z]=_.useState(!1),[D,v]=_.useState(!1),[T,F]=_.useState(""),[N,C]=_.useState(!1),b=_.useRef(null),L=_.useRef(null);_.useEffect(()=>{var $,G;if(!t)return;const H=Xe(t,{width:(($=l[0])==null?void 0:$.width)||20,quality:((G=l[0])==null?void 0:G.quality)||20});S(H),h(0),z(!0),v(!1),F(""),C(!1);let q=!1;return it(t,{stages:l,timeout:g,enableCache:u,onStageComplete:(ee,ce,be)=>{q||(h(ee+1),S(ce),w&&w(ee,ce,be))},onComplete:ee=>{q||(z(!1),C(!0),S(ee),p&&p(ee))},onError:(ee,ce)=>{q||(z(!1),v(!0),F(ee.message),y&&y(ee,ce))}}),()=>{q=!0}},[t,u]);const Z={width:typeof n=="number"?`${n}px`:n,height:typeof a=="number"?`${a}px`:a,position:"relative",overflow:"hidden"},te={width:"100%",height:"100%",objectFit:"cover",transition:`opacity ${f}ms ease-in-out, filter ${f}ms ease-in-out`,opacity:B>=0?1:0,filter:B===0?"blur(10px)":B===1?"blur(3px)":"blur(0px)",...c};return Y.jsxs("div",{ref:b,className:`progressive-image-container ${r}`.trim(),style:Z,children:[j&&B<0&&!D&&Y.jsx("div",{className:"image-optimize-placeholder",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:Y.jsx("svg",{className:"image-optimize-placeholder-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:Y.jsx("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19ZM13.96 12.29L11.21 15.83L9.25 13.47L6.5 17H17.5L13.96 12.29Z",fill:"currentColor"})})}),d&&Y.jsx("img",{ref:L,src:d,alt:o,className:`progressive-image ${s}`.trim(),style:te,onLoad:H=>{N&&R&&R(H)},onError:H=>{D||(v(!0),F("图片加载失败"),y&&y(new Error("图片加载失败"),B))}}),D&&Y.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",color:"#999",fontSize:"14px"},children:[Y.jsx("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"❌"}),Y.jsx("div",{children:T||"加载失败"})]}),P&&!D&&B<l.length&&Y.jsxs("div",{style:{position:"absolute",bottom:"10px",right:"10px",backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},children:["阶段 ",B+1," / ",l.length]})]})}O.LazyImage=It,O.ProgressiveImage=Nt,O.cleanExpiredImageCache=ot,O.clearImageCache=xt,O.compareImageSizes=nt,O.compressImageInBrowser=tt,O.dataURLToBlob=rt,O.default=It,O.deleteImageCache=qe,O.detectCDN=ve,O.detectImageFormat=Je,O.detectSupportedFormats=ze,O.formatFileSize=Te,O.generateBlurPlaceholderUrl=Xe,O.generateResponsiveImage=pt,O.generateSizes=Be,O.generateSrcset=Ze,O.getBestFormat=Me,O.getImageCache=We,O.getImageCacheStats=Pt,O.getImageSize=Ae,O.getOptimizedCoverUrl=wt,O.loadImageProgressive=et,O.loadImageWithCache=st,O.loadImagesBatch=vt,O.loadImagesProgressiveBatch=bt,O.loadImagesProgressively=Qe,O.optimizeImageUrl=pe,O.preloadImage=Ge,O.preloadImages=yt,O.saveImageCache=Ve,Object.defineProperties(O,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
