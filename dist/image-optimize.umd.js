(function(T,F){typeof exports=="object"&&typeof module<"u"?F(exports,require("react")):typeof define=="function"&&define.amd?define(["exports","react"],F):(T=typeof globalThis<"u"?globalThis:T||self,F(T.ImageOptimize={},T.React))})(this,function(T,F){"use strict";function pe(){const t=[];if(typeof window<"u"&&typeof document<"u"){const n=(()=>{try{const i=document.createElement("canvas");return i.width=1,i.height=1,i.toDataURL("image/webp").indexOf("data:image/webp")===0}catch{return!1}})();(()=>{try{const i=document.createElement("canvas");return i.width=1,i.height=1,i.toDataURL("image/avif").indexOf("data:image/avif")===0}catch{return!1}})()&&t.push("avif"),n&&t.push("webp")}return t.push("jpg","jpeg","png"),t}function Se(t=null){const u=pe();if(t){const n=t.toLowerCase().replace("jpeg","jpg");if(u.includes(n))return n}return u[0]||"jpg"}function Fe(t){if(!t)return null;const n=t.toLowerCase().match(/\.(jpg|jpeg|png|gif|webp|avif|bmp|svg)(\?|$)/i);if(n){const a=n[1].toLowerCase();return a==="jpeg"?"jpg":a}try{const a=new URL(t),i=a.searchParams.get("format")||a.searchParams.get("f")||a.searchParams.get("image_format");if(i)return i.toLowerCase().replace("jpeg","jpg")}catch{}return null}const Oe={aliyun:{test:t=>t.includes("aliyuncs.com")||t.includes("oss-"),process:(t,u)=>{const{width:n,height:a,quality:i,format:l}=u,o=[];return(n||a)&&o.push(`resize,w_${n||""},h_${a||""},m_lfit`),i&&o.push(`quality,q_${i}`),l&&o.push(`format,${l}`),o.length>0&&t.searchParams.set("x-oss-process",o.join("/")),t.toString()}},tencent:{test:t=>t.includes("qcloud.com")||t.includes("myqcloud.com"),process:(t,u)=>{const{width:n,height:a,quality:i,format:l}=u,o=[];if((n||a)&&o.push(`imageMogr2/thumbnail/${n}x${a}`),i&&o.push(`quality/${i}`),l&&o.push(`format/${l}`),o.length>0){const s=o.join("|"),d=t.search?"|":"?imageMogr2/";return`${t.toString()}${d}${s}`}return t.toString()}},qiniu:{test:t=>t.includes("qiniucdn.com")||t.includes("qiniu.com"),process:(t,u)=>{const{width:n,height:a,quality:i,format:l}=u,o=[];if((n||a)&&o.push(`imageView2/1/w/${n||""}/h/${a||""}`),i&&o.push(`quality/${i}`),l&&o.push(`format/${l}`),o.length>0){const s=o.join("|"),d=t.search?"|":"?";return`${t.toString()}${d}${s}`}return t.toString()}},upyun:{test:t=>t.includes("upaiyun.com")||t.includes("upyun.com"),process:(t,u)=>{const{width:n,height:a,quality:i,format:l}=u,o=[];if((n||a)&&o.push(`${n||""}x${a||""}`),i&&o.push(`quality/${i}`),l&&o.push(`format/${l}`),o.length>0){const s=t.pathname.split("/"),d=s[s.length-1],w=s.slice(0,-1).join("/")+"/!"+o.join("/")+"/"+d;t.pathname=w}return t.toString()}},cloudfront:{test:t=>t.includes("cloudfront.net")||t.includes(".aws"),process:(t,u)=>{const{width:n,height:a,quality:i,format:l}=u;return n&&t.searchParams.set("w",n),a&&t.searchParams.set("h",a),i&&t.searchParams.set("q",i),l&&t.searchParams.set("f",l),t.toString()}}};function ae(t,u={}){if(!t)return t;const{width:n=null,height:a=null,quality:i=30,format:l=null,autoFormat:o=!0}=u;try{let s;try{s=new URL(t)}catch{if(t.startsWith("/")){const p=typeof window<"u"&&window.location?window.location.origin:"https://example.com";s=new URL(t,p)}else return console.warn("无法解析的图片URL，跳过优化:",t),t}let d=l;o&&!l?d=Se():l&&(d=Se(l));for(const[f,p]of Object.entries(Oe))if(p.test(t))return p.process(s,{width:n,height:a,quality:i,format:d});return n&&s.searchParams.set("w",n),a&&s.searchParams.set("h",a),i&&s.searchParams.set("q",i),d&&s.searchParams.set("f",d),s.toString()}catch(s){return console.warn("图片URL优化失败:",s),t}}function Le(t,u={}){if(!t)return"";const{widths:n=null,aspectRatio:a=null,quality:i=80,format:l=null,autoFormat:o=!0}=u;return(n||[320,640,960,1280,1920]).map(f=>`${ae(t,{width:f,height:a?Math.round(f/a):null,quality:i,format:l,autoFormat:o})} ${f}w`).join(", ")}function Ee(t={}){const{breakpoints:u=["(max-width: 640px) 100vw","(max-width: 1024px) 50vw","33vw"]}=t;return Array.isArray(u)?u.join(", "):u}function ot(t,u={}){if(!t)return{src:"",srcset:"",sizes:""};const{widths:n=null,aspectRatio:a=null,quality:i=80,format:l=null,autoFormat:o=!0,sizes:s=null,fallbackWidth:d=960}=u,w=Le(t,{widths:n,aspectRatio:a,quality:i,format:l,autoFormat:o}),f=s?typeof s=="string"?s:Ee(s):Ee();return{src:ae(t,{width:d,height:a?Math.round(d/a):null,quality:i,format:l,autoFormat:o}),srcset:w,sizes:f}}function st(t){return ae(t,{width:240,height:320,quality:75})}function ke(t){return new Promise(u=>{if(!t){u(!1);return}const n=new Image;n.onload=()=>u(!0),n.onerror=()=>u(!1),n.src=t})}async function lt(t,u=3){const n=[],a=[...t],i=async()=>{for(;a.length>0;){const o=a.shift(),s=await ke(o);n.push({url:o,success:s})}},l=Array(Math.min(u,t.length)).fill(null).map(()=>i());return await Promise.all(l),n}async function Ue(t,u={}){const{concurrency:n=10,timeout:a=3e4,priority:i=!0,stages:l=null,onProgress:o=null,onItemComplete:s=null,onItemStageComplete:d=null,retryOnError:w=!1,maxRetries:f=1}=u,p=t.map((y,m)=>typeof y=="string"?{url:y,priority:0,index:m}:{url:y.url||y.src||"",priority:y.priority||0,index:y.index!==void 0?y.index:m});i&&p.sort((y,m)=>m.priority-y.priority);const P=new Array(p.length);let S=0;const _=p.length,I=async(y,m=0)=>{const{url:E,index:R}=y;if(!E){const j={url:"",success:!1,error:new Error("图片URL为空"),index:R,retries:m};return P[R]=j,S++,o&&o(S,_,j),s&&s(j),j}return l&&Array.isArray(l)&&l.length>0?ve(E,{stages:l,timeout:a,onStageComplete:(x,j,J)=>{d&&d({url:E,index:R,stageIndex:x,stageUrl:j,stage:J,currentStage:x+1,totalStages:l.length},x)},onComplete:x=>{},onError:(x,j)=>{}}).then(x=>{const j={url:x.url,success:x.success,error:x.error,index:R,retries:m,stages:x.stages};return P[R]=j,S++,o&&o(S,_,j),s&&s(j),j}):new Promise(x=>{const j=new Image;let J=!1,z=null;const N=()=>{z&&(clearTimeout(z),z=null),j.onload=null,j.onerror=null,j.src=""},H=(D,B=null)=>{if(J)return null;J=!0,N();const K={url:E,success:D,error:B,index:R,retries:m};return P[R]=K,S++,o&&o(S,_,K),s&&s(K),K};z=setTimeout(()=>{const D=new Error(`图片加载超时 (${a}ms)`),B=H(!1,D);w&&m<f?setTimeout(()=>{I(y,m+1).then(x)},1e3*(m+1)):x(B)},a),j.onload=()=>{const D=H(!0,null);D&&x(D)},j.onerror=D=>{const B=new Error("图片加载失败");B.originalEvent=D;const K=H(!1,B);w&&m<f?setTimeout(()=>{I(y,m+1).then(x)},1e3*(m+1)):x(K)};try{j.crossOrigin="anonymous",j.src=E}catch(D){const B=H(!1,D);B&&x(B)}})},W=[...p],g=new Set,h=[];return await(async()=>{for(;W.length>0||g.size>0;){for(;W.length>0&&g.size<n;){const y=W.shift(),m=I(y).then(E=>(g.delete(m),E)).catch(E=>{g.delete(m);const R={url:y.url,success:!1,error:E instanceof Error?E:new Error(String(E)),index:y.index,retries:0};return P[y.index]=R,S++,o&&o(S,_,R),s&&s(R),R});g.add(m),h.push(m)}g.size>0&&await Promise.race(Array.from(g))}})(),await Promise.all(h),P}async function ut(t,u={}){return Ue(t,{priority:!1,...u})}function Me(t,u={}){if(!t)return t;const{width:n=20,height:a=null,quality:i=20,blur:l=10}=u;return ae(t,{width:n,height:a,quality:i,format:"jpg"})}async function ve(t,u={}){const{stages:n=[{width:20,quality:20,blur:10},{width:400,quality:50,blur:3},{width:null,quality:80,blur:0}],timeout:a=3e4,onStageComplete:i=null,onComplete:l=null,onError:o=null}=u;if(!t){const w=new Error("图片URL为空");return o&&o(w,-1),{url:"",stages:[],success:!1,error:w}}const s=[];let d=t;try{for(let w=0;w<n.length;w++){const f=n[w];let p;w===n.length-1&&!f.width&&!f.height?p=t:p=ae(t,{width:f.width||null,height:f.height||null,quality:f.quality||80,format:f.format||null,autoFormat:f.autoFormat!==!1});const P=await new Promise((S,_)=>{const I=new Image;let W=null,g=!1;const h=()=>{W&&(clearTimeout(W),W=null),I.onload=null,I.onerror=null,I.src=""};W=setTimeout(()=>{if(!g){g=!0,h();const k=new Error(`阶段 ${w+1} 加载超时`);_(k)}},a),I.onload=()=>{g||(g=!0,h(),S({url:p,stage:f,loaded:!0}))},I.onerror=k=>{if(!g){g=!0,h();const y=new Error(`阶段 ${w+1} 加载失败`);y.originalEvent=k,_(y)}};try{I.crossOrigin="anonymous",I.src=p}catch(k){g||(g=!0,h(),_(k))}});s.push(P),d=p,i&&i(w,p,f),w<n.length-1&&await new Promise(S=>setTimeout(S,100))}return l&&l(d),{url:d,stages:s,success:!0,error:null}}catch(w){const f=s.length;return o&&o(w,f),{url:d,stages:s,success:!1,error:w}}}async function ct(t,u={}){const{stages:n=[{width:20,quality:20,blur:10},{width:400,quality:50,blur:3},{width:null,quality:80,blur:0}],concurrency:a=5,timeout:i=3e4,onProgress:l=null,onItemStageComplete:o=null,onItemComplete:s=null}=u,d=t.map((g,h)=>typeof g=="string"?{url:g,index:h}:{url:g.url||g.src||"",index:g.index!==void 0?g.index:h}),w=new Array(d.length);let f=0;const p=d.length,P=async g=>{const{url:h,index:k}=g,y=await ve(h,{stages:n,timeout:i,onStageComplete:(m,E,R)=>{o&&o({url:h,index:k,stageIndex:m,stageUrl:E,stage:R,currentStage:m+1,totalStages:n.length},m)},onComplete:m=>{},onError:(m,E)=>{}});return w[k]=y,f++,l&&l(f,p,y),s&&s(y),y},S=[...d],_=new Set,I=[];return await(async()=>{for(;S.length>0||_.size>0;){for(;S.length>0&&_.size<a;){const g=S.shift(),h=P(g).then(k=>(_.delete(h),k)).catch(k=>{_.delete(h);const y={url:g.url,stages:[],success:!1,error:k instanceof Error?k:new Error(String(k))};return w[g.index]=y,f++,l&&l(f,p,y),s&&s(y),y});_.add(h),I.push(h)}_.size>0&&await Promise.race(Array.from(_))}})(),await Promise.all(I),w}async function Ae(t,u={}){const{maxWidth:n=null,maxHeight:a=null,quality:i=.8,compressionLevel:l=.5,blur:o=0,smooth:s=!0,format:d=null}=u;if(typeof window>"u"||typeof document>"u")throw new Error("浏览器端压缩功能仅在浏览器环境中可用");return new Promise((w,f)=>{const p=new Image;if(p.crossOrigin="anonymous",p.onload=()=>{try{let{width:P,height:S}=p,_=P,I=S,W=!1;if(n||a){const z=Math.min(n?n/P:1,a?a/S:1);z<1&&(_=Math.round(P*z),I=Math.round(S*z),W=!0)}let g=_,h=I;if(l>0){const z=1-l*.75;g=Math.round(_*z),h=Math.round(I*z)}const k=g!==P||h!==S;if(!(k||l>0||o>0)&&typeof t=="string"){w(t);return}const m=document.createElement("canvas");m.width=g,m.height=h;const E=m.getContext("2d");if(k?(E.imageSmoothingEnabled=s,E.imageSmoothingQuality=s?"high":"low"):E.imageSmoothingEnabled=!1,E.drawImage(p,0,0,g,h),o>0){const z=document.createElement("canvas"),N=z.getContext("2d");if(z.width=g,z.height=h,N.drawImage(p,0,0,g,h),N.filter!==void 0)try{N.filter=`blur(${o}px)`,N.drawImage(z,0,0),N.filter="none",E.clearRect(0,0,m.width,m.height),E.drawImage(z,0,0)}catch{De(E,z,g,h,o)}else De(E,z,g,h,o)}let R=d;if(!R)if(l>0||o>0||k)R=pe().includes("webp")?"webp":"jpeg";else{const N=Fe(t);N&&["jpg","jpeg","png"].includes(N)?R=N==="jpeg"?"jpeg":N:R=pe().includes("webp")?"webp":"jpeg"}let x=i;l>0?(x=i*(1-l*.7),x=Math.max(.1,Math.min(1,x))):!k&&o===0?x=Math.max(i,.98):k&&(x=Math.max(i,.92));const j=R==="webp"?"image/webp":R==="png"?"image/png":"image/jpeg",J=m.toDataURL(j,x);w(J)}catch(P){f(new Error("图片压缩失败: "+P.message))}},p.onerror=()=>{f(new Error("图片加载失败"))},typeof t=="string")p.src=t;else if(t instanceof File||t instanceof Blob){const P=new FileReader;P.onload=S=>{p.src=S.target.result},P.onerror=()=>f(new Error("文件读取失败")),P.readAsDataURL(t)}else f(new Error("不支持的图片源类型"))})}function De(t,u,n,a,i){const l=document.createElement("canvas"),o=l.getContext("2d"),s=Math.max(.3,1-i/10),d=Math.round(n*s),w=Math.round(a*s);l.width=d,l.height=w,o.drawImage(u,0,0,n,a,0,0,d,w),t.clearRect(0,0,n,a),t.drawImage(l,0,0,d,w,0,0,n,a)}function Be(t){const u=t.split(","),n=u[0].match(/:(.*?);/)[1],a=atob(u[1]);let i=a.length;const l=new Uint8Array(i);for(;i--;)l[i]=a.charCodeAt(i);return new Blob([l],{type:n})}async function Re(t){if(!t)return null;try{const n=(await fetch(t,{method:"HEAD"})).headers.get("Content-Length");return n?parseInt(n,10):(await(await fetch(t)).blob()).size}catch(u){return console.warn("获取图片大小失败:",t,u),null}}function we(t){if(t==null)return"未知";if(t===0)return"0 B";const u=1024,n=["B","KB","MB","GB"],a=Math.floor(Math.log(t)/Math.log(u));return parseFloat((t/Math.pow(u,a)).toFixed(2))+" "+n[a]}function se(t){if(!t)return null;for(const[u,n]of Object.entries(Oe))if(n.test(t))return u;return null}async function We(t,u){const[n,a]=await Promise.all([Re(t),Re(u)]);let i=null,l=null,o=!1,s=null;return n!==null&&a!==null&&(i=n-a,l=parseFloat((i/n*100).toFixed(2)),o=i>1024||l>1,!o&&i===0?se(t)?s="⚠️ 优化参数可能无效，图片大小未发生变化。请检查CDN配置是否正确。":s="⚠️ 该图片URL不是支持的CDN，通用查询参数可能无效。支持的CDN：阿里云OSS、腾讯云COS、七牛云、又拍云、AWS CloudFront。":!o&&i>0&&l<=1&&(s=`⚠️ 优化效果不明显（仅节省 ${l}%），可能优化参数未生效。`)),{originalUrl:t,optimizedUrl:u,originalSize:n,optimizedSize:a,savedSize:i,savedPercentage:l,isOptimizationEffective:o,warningMessage:s,originalSizeFormatted:we(n),optimizedSizeFormatted:we(a),savedSizeFormatted:we(i),cdn:se(t)}}var xe={exports:{}},ce={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ne;function ft(){if(Ne)return ce;Ne=1;var t=F,u=Symbol.for("react.element"),n=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,i=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function o(s,d,w){var f,p={},P=null,S=null;w!==void 0&&(P=""+w),d.key!==void 0&&(P=""+d.key),d.ref!==void 0&&(S=d.ref);for(f in d)a.call(d,f)&&!l.hasOwnProperty(f)&&(p[f]=d[f]);if(s&&s.defaultProps)for(f in d=s.defaultProps,d)p[f]===void 0&&(p[f]=d[f]);return{$$typeof:u,type:s,key:P,ref:S,props:p,_owner:i.current}}return ce.Fragment=n,ce.jsx=o,ce.jsxs=o,ce}var fe={};/**
 * @license React
 * react-jsx-runtime.development.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ve;function dt(){return Ve||(Ve=1,process.env.NODE_ENV!=="production"&&function(){var t=F,u=Symbol.for("react.element"),n=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),s=Symbol.for("react.context"),d=Symbol.for("react.forward_ref"),w=Symbol.for("react.suspense"),f=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),P=Symbol.for("react.lazy"),S=Symbol.for("react.offscreen"),_=Symbol.iterator,I="@@iterator";function W(e){if(e===null||typeof e!="object")return null;var r=_&&e[_]||e[I];return typeof r=="function"?r:null}var g=t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function h(e){{for(var r=arguments.length,c=new Array(r>1?r-1:0),v=1;v<r;v++)c[v-1]=arguments[v];k("error",e,c)}}function k(e,r,c){{var v=g.ReactDebugCurrentFrame,O=v.getStackAddendum();O!==""&&(r+="%s",c=c.concat([O]));var U=c.map(function(C){return String(C)});U.unshift("Warning: "+r),Function.prototype.apply.call(console[e],console,U)}}var y=!1,m=!1,E=!1,R=!1,x=!1,j;j=Symbol.for("react.module.reference");function J(e){return!!(typeof e=="string"||typeof e=="function"||e===a||e===l||x||e===i||e===w||e===f||R||e===S||y||m||E||typeof e=="object"&&e!==null&&(e.$$typeof===P||e.$$typeof===p||e.$$typeof===o||e.$$typeof===s||e.$$typeof===d||e.$$typeof===j||e.getModuleId!==void 0))}function z(e,r,c){var v=e.displayName;if(v)return v;var O=r.displayName||r.name||"";return O!==""?c+"("+O+")":c}function N(e){return e.displayName||"Context"}function H(e){if(e==null)return null;if(typeof e.tag=="number"&&h("Received an unexpected object in getComponentNameFromType(). This is likely a bug in React. Please file an issue."),typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case a:return"Fragment";case n:return"Portal";case l:return"Profiler";case i:return"StrictMode";case w:return"Suspense";case f:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case s:var r=e;return N(r)+".Consumer";case o:var c=e;return N(c._context)+".Provider";case d:return z(e,e.render,"ForwardRef");case p:var v=e.displayName||null;return v!==null?v:H(e.type)||"Memo";case P:{var O=e,U=O._payload,C=O._init;try{return H(C(U))}catch{return null}}}return null}var D=Object.assign,B=0,K,te,re,Z,X,ie,ne;function de(){}de.__reactDisabledLog=!0;function Ce(){{if(B===0){K=console.log,te=console.info,re=console.warn,Z=console.error,X=console.group,ie=console.groupCollapsed,ne=console.groupEnd;var e={configurable:!0,enumerable:!0,value:de,writable:!0};Object.defineProperties(console,{info:e,log:e,warn:e,error:e,group:e,groupCollapsed:e,groupEnd:e})}B++}}function Pe(){{if(B--,B===0){var e={configurable:!0,enumerable:!0,writable:!0};Object.defineProperties(console,{log:D({},e,{value:K}),info:D({},e,{value:te}),warn:D({},e,{value:re}),error:D({},e,{value:Z}),group:D({},e,{value:X}),groupCollapsed:D({},e,{value:ie}),groupEnd:D({},e,{value:ne})})}B<0&&h("disabledDepth fell below zero. This is a bug in React. Please file an issue.")}}var ge=g.ReactCurrentDispatcher,me;function M(e,r,c){{if(me===void 0)try{throw Error()}catch(O){var v=O.stack.trim().match(/\n( *(at )?)/);me=v&&v[1]||""}return`
`+me+e}}var L=!1,A;{var V=typeof WeakMap=="function"?WeakMap:Map;A=new V}function He(e,r){if(!e||L)return"";{var c=A.get(e);if(c!==void 0)return c}var v;L=!0;var O=Error.prepareStackTrace;Error.prepareStackTrace=void 0;var U;U=ge.current,ge.current=null,Ce();try{if(r){var C=function(){throw Error()};if(Object.defineProperty(C.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(C,[])}catch(Q){v=Q}Reflect.construct(e,[],C)}else{try{C.call()}catch(Q){v=Q}e.call(C.prototype)}}else{try{throw Error()}catch(Q){v=Q}e()}}catch(Q){if(Q&&v&&typeof Q.stack=="string"){for(var b=Q.stack.split(`
`),G=v.stack.split(`
`),Y=b.length-1,$=G.length-1;Y>=1&&$>=0&&b[Y]!==G[$];)$--;for(;Y>=1&&$>=0;Y--,$--)if(b[Y]!==G[$]){if(Y!==1||$!==1)do if(Y--,$--,$<0||b[Y]!==G[$]){var ee=`
`+b[Y].replace(" at new "," at ");return e.displayName&&ee.includes("<anonymous>")&&(ee=ee.replace("<anonymous>",e.displayName)),typeof e=="function"&&A.set(e,ee),ee}while(Y>=1&&$>=0);break}}}finally{L=!1,ge.current=U,Pe(),Error.prepareStackTrace=O}var ue=e?e.displayName||e.name:"",oe=ue?M(ue):"";return typeof e=="function"&&A.set(e,oe),oe}function mt(e,r,c){return He(e,!1)}function ht(e){var r=e.prototype;return!!(r&&r.isReactComponent)}function ye(e,r,c){if(e==null)return"";if(typeof e=="function")return He(e,ht(e));if(typeof e=="string")return M(e);switch(e){case w:return M("Suspense");case f:return M("SuspenseList")}if(typeof e=="object")switch(e.$$typeof){case d:return mt(e.render);case p:return ye(e.type,r,c);case P:{var v=e,O=v._payload,U=v._init;try{return ye(U(O),r,c)}catch{}}}return""}var he=Object.prototype.hasOwnProperty,Ye={},$e=g.ReactDebugCurrentFrame;function be(e){if(e){var r=e._owner,c=ye(e.type,e._source,r?r.type:null);$e.setExtraStackFrame(c)}else $e.setExtraStackFrame(null)}function pt(e,r,c,v,O){{var U=Function.call.bind(he);for(var C in e)if(U(e,C)){var b=void 0;try{if(typeof e[C]!="function"){var G=Error((v||"React class")+": "+c+" type `"+C+"` is invalid; it must be a function, usually from the `prop-types` package, but received `"+typeof e[C]+"`.This often happens because of typos such as `PropTypes.function` instead of `PropTypes.func`.");throw G.name="Invariant Violation",G}b=e[C](r,C,v,c,null,"SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED")}catch(Y){b=Y}b&&!(b instanceof Error)&&(be(O),h("%s: type specification of %s `%s` is invalid; the type checker function must return `null` or an `Error` but returned a %s. You may have forgotten to pass an argument to the type checker creator (arrayOf, instanceOf, objectOf, oneOf, oneOfType, and shape all require an argument).",v||"React class",c,C,typeof b),be(null)),b instanceof Error&&!(b.message in Ye)&&(Ye[b.message]=!0,be(O),h("Failed %s type: %s",c,b.message),be(null))}}}var vt=Array.isArray;function _e(e){return vt(e)}function wt(e){{var r=typeof Symbol=="function"&&Symbol.toStringTag,c=r&&e[Symbol.toStringTag]||e.constructor.name||"Object";return c}}function yt(e){try{return Je(e),!1}catch{return!0}}function Je(e){return""+e}function Ke(e){if(yt(e))return h("The provided key is an unsupported type %s. This value must be coerced to a string before before using it here.",wt(e)),Je(e)}var Ze=g.ReactCurrentOwner,bt={key:!0,ref:!0,__self:!0,__source:!0},Ge,Qe;function St(e){if(he.call(e,"ref")){var r=Object.getOwnPropertyDescriptor(e,"ref").get;if(r&&r.isReactWarning)return!1}return e.ref!==void 0}function Et(e){if(he.call(e,"key")){var r=Object.getOwnPropertyDescriptor(e,"key").get;if(r&&r.isReactWarning)return!1}return e.key!==void 0}function Rt(e,r){typeof e.ref=="string"&&Ze.current}function xt(e,r){{var c=function(){Ge||(Ge=!0,h("%s: `key` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",r))};c.isReactWarning=!0,Object.defineProperty(e,"key",{get:c,configurable:!0})}}function Ct(e,r){{var c=function(){Qe||(Qe=!0,h("%s: `ref` is not a prop. Trying to access it will result in `undefined` being returned. If you need to access the same value within the child component, you should pass it as a different prop. (https://reactjs.org/link/special-props)",r))};c.isReactWarning=!0,Object.defineProperty(e,"ref",{get:c,configurable:!0})}}var Pt=function(e,r,c,v,O,U,C){var b={$$typeof:u,type:e,key:r,ref:c,props:C,_owner:U};return b._store={},Object.defineProperty(b._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(b,"_self",{configurable:!1,enumerable:!1,writable:!1,value:v}),Object.defineProperty(b,"_source",{configurable:!1,enumerable:!1,writable:!1,value:O}),Object.freeze&&(Object.freeze(b.props),Object.freeze(b)),b};function _t(e,r,c,v,O){{var U,C={},b=null,G=null;c!==void 0&&(Ke(c),b=""+c),Et(r)&&(Ke(r.key),b=""+r.key),St(r)&&(G=r.ref,Rt(r,O));for(U in r)he.call(r,U)&&!bt.hasOwnProperty(U)&&(C[U]=r[U]);if(e&&e.defaultProps){var Y=e.defaultProps;for(U in Y)C[U]===void 0&&(C[U]=Y[U])}if(b||G){var $=typeof e=="function"?e.displayName||e.name||"Unknown":e;b&&xt(C,$),G&&Ct(C,$)}return Pt(e,b,G,O,v,Ze.current,C)}}var je=g.ReactCurrentOwner,Xe=g.ReactDebugCurrentFrame;function le(e){if(e){var r=e._owner,c=ye(e.type,e._source,r?r.type:null);Xe.setExtraStackFrame(c)}else Xe.setExtraStackFrame(null)}var ze;ze=!1;function Ie(e){return typeof e=="object"&&e!==null&&e.$$typeof===u}function et(){{if(je.current){var e=H(je.current.type);if(e)return`

Check the render method of \``+e+"`."}return""}}function jt(e){return""}var tt={};function zt(e){{var r=et();if(!r){var c=typeof e=="string"?e:e.displayName||e.name;c&&(r=`

Check the top-level render call using <`+c+">.")}return r}}function rt(e,r){{if(!e._store||e._store.validated||e.key!=null)return;e._store.validated=!0;var c=zt(r);if(tt[c])return;tt[c]=!0;var v="";e&&e._owner&&e._owner!==je.current&&(v=" It was passed a child from "+H(e._owner.type)+"."),le(e),h('Each child in a list should have a unique "key" prop.%s%s See https://reactjs.org/link/warning-keys for more information.',c,v),le(null)}}function nt(e,r){{if(typeof e!="object")return;if(_e(e))for(var c=0;c<e.length;c++){var v=e[c];Ie(v)&&rt(v,r)}else if(Ie(e))e._store&&(e._store.validated=!0);else if(e){var O=W(e);if(typeof O=="function"&&O!==e.entries)for(var U=O.call(e),C;!(C=U.next()).done;)Ie(C.value)&&rt(C.value,r)}}}function It(e){{var r=e.type;if(r==null||typeof r=="string")return;var c;if(typeof r=="function")c=r.propTypes;else if(typeof r=="object"&&(r.$$typeof===d||r.$$typeof===p))c=r.propTypes;else return;if(c){var v=H(r);pt(c,e.props,"prop",v,e)}else if(r.PropTypes!==void 0&&!ze){ze=!0;var O=H(r);h("Component %s declared `PropTypes` instead of `propTypes`. Did you misspell the property assignment?",O||"Unknown")}typeof r.getDefaultProps=="function"&&!r.getDefaultProps.isReactClassApproved&&h("getDefaultProps is only used on classic React.createClass definitions. Use a static property named `defaultProps` instead.")}}function Tt(e){{for(var r=Object.keys(e.props),c=0;c<r.length;c++){var v=r[c];if(v!=="children"&&v!=="key"){le(e),h("Invalid prop `%s` supplied to `React.Fragment`. React.Fragment can only have `key` and `children` props.",v),le(null);break}}e.ref!==null&&(le(e),h("Invalid attribute `ref` supplied to `React.Fragment`."),le(null))}}var at={};function it(e,r,c,v,O,U){{var C=J(e);if(!C){var b="";(e===void 0||typeof e=="object"&&e!==null&&Object.keys(e).length===0)&&(b+=" You likely forgot to export your component from the file it's defined in, or you might have mixed up default and named imports.");var G=jt();G?b+=G:b+=et();var Y;e===null?Y="null":_e(e)?Y="array":e!==void 0&&e.$$typeof===u?(Y="<"+(H(e.type)||"Unknown")+" />",b=" Did you accidentally export a JSX literal instead of a component?"):Y=typeof e,h("React.jsx: type is invalid -- expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",Y,b)}var $=_t(e,r,c,O,U);if($==null)return $;if(C){var ee=r.children;if(ee!==void 0)if(v)if(_e(ee)){for(var ue=0;ue<ee.length;ue++)nt(ee[ue],e);Object.freeze&&Object.freeze(ee)}else h("React.jsx: Static children should always be an array. You are likely explicitly calling React.jsxs or React.jsxDEV. Use the Babel transform instead.");else nt(ee,e)}if(he.call(r,"key")){var oe=H(e),Q=Object.keys(r).filter(function(Mt){return Mt!=="key"}),Te=Q.length>0?"{key: someKey, "+Q.join(": ..., ")+": ...}":"{key: someKey}";if(!at[oe+Te]){var Ut=Q.length>0?"{"+Q.join(": ..., ")+": ...}":"{}";h(`A props object containing a "key" prop is being spread into JSX:
  let props = %s;
  <%s {...props} />
React keys must be passed directly to JSX without using spread:
  let props = %s;
  <%s key={someKey} {...props} />`,Te,oe,Ut,oe),at[oe+Te]=!0}}return e===a?Tt($):It($),$}}function Ft(e,r,c){return it(e,r,c,!0)}function Ot(e,r,c){return it(e,r,c,!1)}var Lt=Ot,kt=Ft;fe.Fragment=a,fe.jsx=Lt,fe.jsxs=kt}()),fe}process.env.NODE_ENV==="production"?xe.exports=ft():xe.exports=dt();var q=xe.exports;function qe({src:t="",alt:u="",width:n="100%",height:a="auto",className:i="",imageClassName:l="",dataId:o=null,imageStyle:s={},immediate:d=!1,rootMargin:w="50px",optimize:f={width:240,height:320,quality:30},enableBrowserCompression:p=!0,showPlaceholderIcon:P=!1,showErrorMessage:S=!1,errorSrc:_=null,onLoad:I=null,onOptimization:W=null,onError:g=null,onClick:h=null}){const k=F.useRef(null),y=F.useRef(null),m=F.useRef(null),E=F.useRef(null),[R,x]=F.useState(!1),[j,J]=F.useState(!1),[z,N]=F.useState(!1),[H,D]=F.useState(d),[B,K]=F.useState(""),[te,re]=F.useState(null),[Z,X]=F.useState(!1),ie=M=>{if(!M)return"";try{if(f&&Object.keys(f).length>0){const L=ae(M,f);if(L&&L.trim())return L}return M}catch(L){return console.warn("图片URL优化失败，使用原始URL:",L),M}},ne=F.useMemo(()=>t?te||(R&&B?B:ie(t)):"",[t,R,B,f,te]),de=()=>{if(d||typeof window>"u"||!window.IntersectionObserver){D(!0);return}m.current&&(m.current.disconnect(),m.current=null),m.current=new IntersectionObserver(M=>{M.forEach(L=>{L.isIntersecting&&(D(!0),m.current&&L.target&&m.current.unobserve(L.target))})},{rootMargin:w,threshold:.01}),setTimeout(()=>{y.current&&m.current&&m.current.observe(y.current)},0)},Ce=async M=>{if(R)return;const L=M.target.src;x(!0),J(!1),N(!1),K(L);let A=null;if(t&&L!==t)try{const V=await We(t,L);V.originalSize!==null&&V.optimizedSize!==null?(A={originalUrl:V.originalUrl,originalSize:V.originalSize,originalSizeFormatted:V.originalSizeFormatted,optimizedUrl:V.optimizedUrl,optimizedSize:V.optimizedSize,optimizedSizeFormatted:V.optimizedSizeFormatted,savedSize:V.savedSize,savedSizeFormatted:V.savedSizeFormatted,savedPercentage:V.savedPercentage,cdn:V.cdn,isOptimizationEffective:V.isOptimizationEffective,warningMessage:V.warningMessage},E.current=A,W&&W(A),V.cdn,V.warningMessage&&console.warn(V.warningMessage),V.isOptimizationEffective):(A={originalUrl:t,optimizedUrl:L,originalSize:null,originalSizeFormatted:null,optimizedSize:null,optimizedSizeFormatted:null,savedSize:null,savedSizeFormatted:null,savedPercentage:null,cdn:se(t),isOptimizationEffective:null,warningMessage:"⚠️ 无法获取图片大小（可能由于CORS限制）"},E.current=A,W&&W(A))}catch(V){console.warn("获取图片大小对比失败:",V),A={originalUrl:t,optimizedUrl:L,originalSize:null,originalSizeFormatted:null,optimizedSize:null,optimizedSizeFormatted:null,savedSize:null,savedSizeFormatted:null,savedPercentage:null,cdn:se(t),isOptimizationEffective:null,warningMessage:`获取图片大小对比失败: ${V.message}`},E.current=A,W&&W(A)}I&&I(M,A)},Pe=M=>{if(R)return;const L=M.target.src,A=ie(t);if(_&&(L===_||L.includes("videoCover.png"))){N(!0),J(!1),g&&g(M);return}if(L===A&&A!==t){console.log("优化URL加载失败，尝试原始URL:",t),M.target.src=t;return}if(L===t||A===t){if(_&&L!==_){console.log("原始URL加载失败，尝试加载错误图片:",_),M.target.src=_;return}console.log("图片加载失败，显示错误占位符"),N(!0),J(!1),g&&g(M)}},ge=M=>{var L;if(h){const A={src:t,currentSrc:((L=M.target)==null?void 0:L.src)||ne,optimizedSrc:ne,alt:u,dataId:o,isLoaded:R,isLoading:j,hasError:z,isCompressing:Z,optimizationInfo:E.current,imageElement:M.target};h(M,A)}};F.useEffect(()=>{if(H&&!R&&!z&&!j&&!Z&&t){const M=se(t);p&&!M&&f&&Object.keys(f).length>0&&typeof window<"u"&&!te?(X(!0),Ae(t,{maxWidth:f.width||null,maxHeight:f.height||null,quality:f.quality?f.quality/100:.8,compressionLevel:f.compressionLevel!==void 0?f.compressionLevel:0,blur:f.blur!==void 0?f.blur:0,smooth:f.smooth!==void 0?f.smooth:!0,format:f.format||null}).then(A=>{re(A),X(!1),Be(A)}).catch(A=>{console.warn("浏览器端压缩失败，使用原始URL:",A),X(!1)})):J(!0)}},[H,R,z,j,Z,t,f,te,p]),F.useEffect(()=>{x(!1),N(!1),J(!1),K(""),re(null),X(!1),E.current=null,d?D(!0):de()},[t]),F.useEffect(()=>(d?D(!0):de(),()=>{m.current&&(m.current.disconnect(),m.current=null)}),[]);const me={width:typeof n=="number"?`${n}px`:n,height:typeof a=="number"?`${a}px`:a};return q.jsxs("div",{ref:y,className:`image-optimize-container ${i}`.trim(),style:me,children:[!R&&!z&&!j&&q.jsx("div",{className:"image-optimize-placeholder",children:P&&q.jsx("svg",{className:"image-optimize-placeholder-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:q.jsx("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19ZM13.96 12.29L11.21 15.83L9.25 13.47L6.5 17H17.5L13.96 12.29Z",fill:"currentColor"})})}),(j||Z)&&!z&&q.jsxs("div",{className:"image-optimize-loading",children:[q.jsx("svg",{className:"image-optimize-loading-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:q.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none",strokeDasharray:"62.83",strokeDashoffset:"31.42"})}),Z&&q.jsx("span",{style:{marginTop:"8px",fontSize:"12px",color:"#666"},children:"正在压缩图片..."})]}),H&&ne&&q.jsx("img",{ref:k,src:ne,alt:u,"data-id":o,className:`image-optimize-image ${l}`.trim(),style:{display:R||!z&&ne?"block":"none",...s},onLoad:Ce,onError:Pe,onClick:ge}),z&&q.jsxs("div",{className:"image-optimize-error",children:[q.jsx("svg",{className:"image-optimize-error-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:q.jsx("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19Z",fill:"currentColor"})}),S&&q.jsx("span",{className:"image-optimize-error-text",children:"加载失败"})]})]})}function gt({src:t="",alt:u="",width:n="100%",height:a="auto",className:i="",imageClassName:l="",imageStyle:o={},stages:s=[{width:20,quality:20},{width:400,quality:50},{width:null,quality:80}],transitionDuration:d=300,timeout:w=3e4,showPlaceholder:f=!0,onStageComplete:p=null,onComplete:P=null,onError:S=null,onLoad:_=null}){const[I,W]=F.useState(-1),[g,h]=F.useState(""),[k,y]=F.useState(!1),[m,E]=F.useState(!1),[R,x]=F.useState(""),[j,J]=F.useState(!1),z=F.useRef(null),N=F.useRef(null);F.useEffect(()=>{var te,re;if(!t)return;const B=Me(t,{width:((te=s[0])==null?void 0:te.width)||20,quality:((re=s[0])==null?void 0:re.quality)||20});h(B),W(0),y(!0),E(!1),x(""),J(!1);let K=!1;return ve(t,{stages:s,timeout:w,onStageComplete:(Z,X,ie)=>{K||(W(Z+1),h(X),p&&p(Z,X,ie))},onComplete:Z=>{K||(y(!1),J(!0),h(Z),P&&P(Z))},onError:(Z,X)=>{K||(y(!1),E(!0),x(Z.message),S&&S(Z,X))}}),()=>{K=!0}},[t]);const H={width:typeof n=="number"?`${n}px`:n,height:typeof a=="number"?`${a}px`:a,position:"relative",overflow:"hidden"},D={width:"100%",height:"100%",objectFit:"cover",transition:`opacity ${d}ms ease-in-out, filter ${d}ms ease-in-out`,opacity:I>=0?1:0,filter:I===0?"blur(10px)":I===1?"blur(3px)":"blur(0px)",...o};return q.jsxs("div",{ref:z,className:`progressive-image-container ${i}`.trim(),style:H,children:[f&&I<0&&!m&&q.jsx("div",{className:"image-optimize-placeholder",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:q.jsx("svg",{className:"image-optimize-placeholder-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:q.jsx("path",{d:"M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3ZM19 19H5V5H19V19ZM13.96 12.29L11.21 15.83L9.25 13.47L6.5 17H17.5L13.96 12.29Z",fill:"currentColor"})})}),g&&q.jsx("img",{ref:N,src:g,alt:u,className:`progressive-image ${l}`.trim(),style:D,onLoad:B=>{j&&_&&_(B)},onError:B=>{m||(E(!0),x("图片加载失败"),S&&S(new Error("图片加载失败"),I))}}),m&&q.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",backgroundColor:"#f5f5f5",color:"#999",fontSize:"14px"},children:[q.jsx("div",{style:{fontSize:"24px",marginBottom:"8px"},children:"❌"}),q.jsx("div",{children:R||"加载失败"})]}),k&&!m&&I<s.length&&q.jsxs("div",{style:{position:"absolute",bottom:"10px",right:"10px",backgroundColor:"rgba(0, 0, 0, 0.6)",color:"white",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},children:["阶段 ",I+1," / ",s.length]})]})}T.LazyImage=qe,T.ProgressiveImage=gt,T.compareImageSizes=We,T.compressImageInBrowser=Ae,T.dataURLToBlob=Be,T.default=qe,T.detectCDN=se,T.detectImageFormat=Fe,T.detectSupportedFormats=pe,T.formatFileSize=we,T.generateBlurPlaceholderUrl=Me,T.generateResponsiveImage=ot,T.generateSizes=Ee,T.generateSrcset=Le,T.getBestFormat=Se,T.getImageSize=Re,T.getOptimizedCoverUrl=st,T.loadImageProgressive=ve,T.loadImagesBatch=ut,T.loadImagesProgressiveBatch=ct,T.loadImagesProgressively=Ue,T.optimizeImageUrl=ae,T.preloadImage=ke,T.preloadImages=lt,Object.defineProperties(T,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
